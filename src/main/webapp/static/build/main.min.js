"use strict";var app=angular.module("app",["ngRoute","ngTable","datepicker"],function(e){e.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8";var t=function(e){var r,s,a,o,n,i,u,c="";for(r in e)if(s=e[r],s instanceof Array)for(u=0;u<s.length;++u)n=s[u],a=r+"["+u+"]",i={},i[a]=n,c+=t(i)+"&";else if(s instanceof Object)for(o in s)n=s[o],a=r+"["+o+"]",i={},i[a]=n,c+=t(i)+"&";else void 0!==s&&null!==s&&(c+=encodeURIComponent(r)+"="+encodeURIComponent(s)+"&");return c.length?c.substr(0,c.length-1):c};e.defaults.transformRequest=[function(e){return angular.isObject(e)&&"[object File]"!==String(e)?t(e):e}]});app.controller("MainCtrl",function(e,t){e.to=function(e){t.path(e)}}),app.controller("IndexCtrl",function(e,t,r){r.menu="#"});var fdRouterViewsBasepath="static/app/modules/";app.config(["$routeProvider",function(e){e.when("/",{templateUrl:fdRouterViewsBasepath+"index/views/index.html",controller:"IndexCtrl"}).when("/custommgr/list",{templateUrl:fdRouterViewsBasepath+"custom/views/custommgrlist.html",controller:"CustomMgrListCtrl"}).when("/custommgr/incustom",{templateUrl:fdRouterViewsBasepath+"custom/views/custommgrincustom.html",controller:"CustomMgrInCustomCtrl"}).when("/custommgr/editcustom/:id",{templateUrl:fdRouterViewsBasepath+"custom/views/custommgrincustom.html",controller:"CustomMgrInCustomCtrl"}).when("/custommgr/viewcustom/:id",{templateUrl:fdRouterViewsBasepath+"custom/views/custommgrviewcustom.html",controller:"CustomMgrViewCustomCtrl"}).when("/jobmgr/list",{templateUrl:fdRouterViewsBasepath+"job/views/jobmgrlist.html",controller:"JobMgrListCtrl"}).when("/jobmgr/injob",{templateUrl:fdRouterViewsBasepath+"job/views/jobmgrinjob.html",controller:"JobMgrInJobCtrl"}).when("/jobmgr/editjob/:id",{templateUrl:fdRouterViewsBasepath+"job/views/jobmgrinjob.html",controller:"JobMgrInJobCtrl"}).when("/jobmgr/viewjob/:id",{templateUrl:fdRouterViewsBasepath+"job/views/jobmgrviewjob.html",controller:"JobMgrViewJobCtrl"}).when("/resumemgr/list",{templateUrl:fdRouterViewsBasepath+"resume/views/resumemgrlist.html",controller:"ResumeMgrListCtrl"}).when("/resumemgr/inresume",{templateUrl:fdRouterViewsBasepath+"resume/views/resumemgrinresume.html",controller:"ResumeMgrInResumeCtrl"}).when("/resumemgr/editresume/:id",{templateUrl:fdRouterViewsBasepath+"resume/views/resumemgrinresume.html",controller:"ResumeMgrInResumeCtrl"}).when("/resumemgr/viewresume/:id",{templateUrl:fdRouterViewsBasepath+"resume/views/resumemgrviewresume.html",controller:"ResumeMgrViewResumeCtrl"}).when("/contractmgr/list",{templateUrl:fdRouterViewsBasepath+"contract/views/contractmgrlist.html",controller:"ContractMgrListCtrl"}).when("/contractmgr/incontract",{templateUrl:fdRouterViewsBasepath+"contract/views/contractmgrincontract.html",controller:"ContractMgrInContractCtrl"}).when("/contractmgr/incontract/:contractid",{templateUrl:fdRouterViewsBasepath+"contract/views/contractmgrincontract.html",controller:"ContractMgrInContractCtrl"}).when("/contractmgr/editcontract/:id",{templateUrl:fdRouterViewsBasepath+"contract/views/contractmgrincontract.html",controller:"ContractMgrInContractCtrl"}).when("/contractmgr/viewcontract/:id",{templateUrl:fdRouterViewsBasepath+"contract/views/contractmgrviewcontract.html",controller:"ContractMgrViewContractCtrl"}).when("/invoicemgr/list",{templateUrl:fdRouterViewsBasepath+"invoice/views/invoicemgrlist.html",controller:"InvoiceMgrListCtrl"}).when("/invoicemgr/ininvoice",{templateUrl:fdRouterViewsBasepath+"invoice/views/invoicemgrininvoice.html",controller:"InvoiceMgrInInvoiceCtrl"}).when("/invoicemgr/editcustom/:id",{templateUrl:fdRouterViewsBasepath+"invoice/views/invoicemgrininvoice.html",controller:"InvoiceMgrInInvoiceCtrl"}).when("/invoicemgr/viewinvoice/:id",{templateUrl:fdRouterViewsBasepath+"custom/views/invoicemgrviewinvoice.html",controller:"InvoiceMgrViewInvoiceCtrl"}).when("/performancemgr/list",{templateUrl:fdRouterViewsBasepath+"performance/views/performancemgrlist.html",controller:"PerformanceMgrListCtrl"}).when("/teammgr/list",{templateUrl:fdRouterViewsBasepath+"team/views/teammgrlist.html",controller:"TeamMgrListCtrl"}).when("/teammgr/myinfo",{templateUrl:fdRouterViewsBasepath+"team/views/teammgrmyinfo.html",controller:"TeamMgrMyInfoCtrl"}).when("/usermgr/list",{templateUrl:fdRouterViewsBasepath+"user/views/usermgrlist.html",controller:"UserMgrListCtrl"}).when("/usermgr/inuser",{templateUrl:fdRouterViewsBasepath+"user/views/usermgrinuser.html",controller:"UserMgrInUserCtrl"}).when("/usermgr/editcustom/:id",{templateUrl:fdRouterViewsBasepath+"user/views/usermgrinuser.html",controller:"UserMgrInUserCtrl"}).when("/usermgr/viewuser/:id",{templateUrl:fdRouterViewsBasepath+"custom/views/usermgrviewuser.html",controller:"UserMgrViewUserCtrl"}).when("/usermgr/resetpwd",{templateUrl:fdRouterViewsBasepath+"user/views/userresetpwd.html",controller:"UserResetPwdCtrl"}).when("/pubmgr/list",{templateUrl:fdRouterViewsBasepath+"pub/views/pubmgrlist.html",controller:"PubMgrListCtrl"}).when("/pubmgr/inpub",{templateUrl:fdRouterViewsBasepath+"pub/views/pubmgrinpub.html",controller:"PubMgrInPubCtrl"}).when("/pubmgr/editpub",{templateUrl:fdRouterViewsBasepath+"pub/views/pubmgreditpub.html",controller:"PubMgrEditPubCtrl"}).otherwise({redirectTo:"/"})}]),app.filter("trustHtml",function(e){return function(t){return e.trustAsHtml(t)}}),angular.module("datepicker",[]).directive("datepicker",[function(){return{restrict:"A",require:"ngModel",link:function(e,t,r,s){$(function(){t.datepicker({dateFormat:"yy-mm-dd",onSelect:function(t){e.$apply(function(){s.$setViewValue(t)})}})})}}}]),app.factory("BaseInfoService",["$http","ngTableParams",function(e,t){var r=null;return{getUserInfo:function(t){r?data&&t(data):e.post("getLoginUser").success(function(e){e&&t(e)})},pageSearch:function(r){var s=r.$scope,a=r.params,o=r.url,n=r.page;void 0==n&&(n=10);r.items;a||(s[a]={});var i=new t({page:0,count:n},{total:0,getData:function(t,r){s[a].isreload?s[a].isreload=!1:(s[a].page=r.page(),s[a].rows=r.count(),s[a].total=r.total()),e.post(o,s[a]).success(function(e){var o=e.total;s[a].total=o,r.total(o),t.resolve(e.rows)})}});return i}}}]),app.directive("coreBasedata",["$http",function(){var e={customIndustry:[["房地产开发/建筑与工程","房地产开发/建筑与工程"],["金融业(投资/保险/证券/银行/基金)","金融业(投资/保险/证券/银行/基金)"]],customSource:[["广告呼入","广告呼入"],["主动BD","主动BD"],["机构合作","机构合作"],["人脉推荐","人脉推荐"]],customState:[["潜在客户","潜在客户"],["签约运作","签约运作"],["签约暂停","签约暂停"],["签约终止","签约终止"]],contractState:[["运作","运作"],["暂停","暂停"],["终止","终止"]],jobState:[["运作","运作"],["结束","结束"],["暂停","暂停"],["关闭","关闭"]],zone:[["北京","北京"],["上海","上海"],["广州","广州"]],duty:[["经营管理类","经营管理类"],["财务/审计/统计类","财务/审计/统计类"],["人力资源类","人力资源类"]],edu:[["博士以上","博士以上"],["硕士以上","硕士以上"],["本科以上","本科以上"],["大专以上","大专以上"]],yearpay:[["10万以下","10万以下"],["10-15万","10-15万"],["15-20万","15-20万"],["20-30万","20-30万"],["30-50万","30-50万"],["50-100万","50-100万"],["100-150万","100-150万"],["150-200万","150-200万"],["200万以上","200万以上"]]};return{restrict:"A",scope:{value:"@value",type:"@type",key:"@key",name:"@name",bindModel:"=bindModel",allSelectName:"@allSelectName"},templateUrl:"static/app/components/directives/core/views/basedata.html",replace:!0,require:"?ngModel",link:function(t,r,s,a){t.items=e[t.key],t.click=function(e,t){if(a.$setViewValue(e),t){var r=$(t);r.siblings().removeClass("select"),r.addClass("select")}}}}}]),app.directive("coreCustomselect",["$http",function(e){return{restrict:"A",replace:!0,scope:{customid:"=customid"},require:"ngModel",templateUrl:"static/app/components/directives/core/views/customselect.html",link:function(t,r,s,a){var o=!1;t.ok=function(e){t.customname=e.custom_name,a.$setViewValue(e)},t.$watch("customid",function(r){r&&(o||(o=!0,e.post("custom/getCustomById",{id:r}).success(function(e){e.custom&&(t.customname=e.custom.customName)})))},!0),t.$watch("customsearch",function(r,s){r!=s&&e.post("custom/list",{companyName:r,page:1,rows:100}).success(function(e){t.customs=e.rows})},!0)}}}]),app.directive("coreFileupload",["$http",function(e){return{restrict:"A",scope:{attas:"=attas"},require:"?ngModel",templateUrl:"static/app/components/directives/core/views/fileupload.html",link:function(t,r,s,a){function o(e){var t="";if(e&&e.length>0)for(var r=0;r<e.length;r++)t+=e[r].id,r!=e.length-1&&(t+=",");return t}function n(e){var r=[];for(var s in t.attas){var a=t.attas[s];a.id!=e&&r.push(a)}t.attas=r}t.$watch("attaresult",function(){var e=t.attaresult;t.attaformresult=e,e&&"1"==e.success&&(t.attas||(t.attas=[]),t.attas.push(e.data),a.$setViewValue(o(t.attas)))}),t.delAttach=function(r){e.post("fileDel",{id:r.id}).success(function(e){t.attaformresult=e,n(r.id),a.$setViewValue(o(t.attas))})}}}}]),app.directive("coreFormresult",["$timeout",function(e){var t=null;return{restrict:"A",scope:{formresult:"=result"},templateUrl:"static/app/components/directives/core/views/formresult.html",link:function(r){r.$watch("formresult",function(){null!=r.formresult&&"1"==r.formresult.success&&(e.cancel(t),t=e(function(){r.formresult=null},4e3),r.$on("$destroy",function(){e.cancel(t)}))})}}}]),app.directive("coreFu",["$http",function(){return{restrict:"A",require:"?ngModel",link:function(e,t,r,s){var a={dataType:"json",url:"fileUpload"};a.started=function(){e.$apply(function(){s.$setViewValue({success:"0",message:"上传中..."})})},a.done=function(t,r){e.$apply(function(){s.$setViewValue(r.result)})},a.fail=function(){e.$apply(function(){s.$setViewValue({success:"0",message:"上传失败"})})},t.fileupload(a)}}}]),app.directive("corePermission",["BaseInfoService",function(e){return{restrict:"A",link:function(t,r,s){var a=r.style.display;r.style.display="none",e.getUserInfo(function(e){var t=!1,o=!1,n=e.userType;if("1"!=n){var i=s.roles.split(",");if(i.length>0)for(var u in i){var c=i[u];if(c==n){t=!0;break}}{s.funid}o=!0,t&&o&&(r.style.display=a)}else r.style.display=a})}}}]),app.directive("coreTeamselect",["$http",function(){return{restrict:"A",replace:!0,scope:{te:"=bindteam",teamselect:"=teamselect"},templateUrl:"static/app/components/directives/core/views/teamselect.html",link:function(e){function t(){var t=[],r=e.teamselect.select;for(var s in r)t.push(r[s].id);e.te=t.join(",")}e.addItem=function(r,s){e.teamselect.unSelect.splice(s,1),e.teamselect.select.push(r),t()},e.removeItem=function(r,s){e.teamselect.select.splice(s,1),e.teamselect.unSelect.push(r),t()}}}}]),app.controller("ContractMgrInContractCtrl",function(e,t,r,s,a){function o(r){n()&&(e.isrequest=!0,e.contract.customId=e.custom.id,t.post("contract/edit",e.contract).success(function(t){e.formresult=t,e.isrequest=!1,r&&r(t)}))}function n(){return $("#contracteditform").isHappy({fields:{}})}a.menu="contract";var i=r.id,u=r.customId;e.isReady=!1,u&&t.post("custom/getCustomById",{id:u}).success(function(t){e.custom=t,e.isReady=!0}),i&&t.post("contract/getContractViewById",{id:i}).success(function(t){e.custom=t.custom,e.contract=t.contract,e.attachs=t.attachs,e.isReady=!0}),i||u||(e.isReady=!0),e.save=function(){o(function(e){"1"==e.success&&$location.path("contractmgr/list")})}}),app.controller("ContractMgrListCtrl",function(e,t,r,s,a){a.menu="contract";var o=1,n=10;e.search={},e.queryParams={rows:n},e.initParams=function(t){var r=o;t&&(r=e.queryParams.page);var s={page:r,rows:e.queryParams.rows,isreload:!0};angular.extend(s,e.search),angular.extend(e.queryParams,s)},e.initParams(),e.reload=function(t){e.initParams(t),e.tableParams.reload()},e.tableParams=new s({page:o,count:n},{total:0,getData:function(r,s){e.queryParams.isreload?e.queryParams.isreload=!1:(e.queryParams.page=s.page(),e.queryParams.rows=s.count(),e.queryParams.total=s.total()),t.post("contract/list",e.queryParams).success(function(t){var a=t.total;e.queryParams.total=a,s.total(a),s.page(e.queryParams.page),r.resolve(t.rows)})}}),e.$watch("search",function(t,r){t!=r&&e.reload()},!0),e.del=function(r){t.post("contract/del",{id:r.id}).success(function(t){e.formresult=t,e.reload(!0)})}}),app.controller("ContractMgrViewContractCtrl",function(e,t,r,s,a){a.menu="contract";var o=r.id;e.isReady=!1,t.post("contract/getContractViewById",{id:o}).success(function(t){e.custom=t.custom,e.contract=t.contract,e.jobs=t.jobs,e.isReady=!0})}),app.factory("ContractService",["$http",function(e){return{test:function(t,r){e.post("formdesign/formdatadel",t).success(function(e){r&&r(e)})}}}]),app.controller("FormDataListCtrl",function(e,t,r,s,a,o,n){var i=1,u=10;e.initParams=function(){e.queryParams={page:i,rows:u,formid:r.formid,isreload:!0}},e.initParams(),e.reload=function(){e.initParams(),e.tableParams.reload()},e.tableParams=new s({page:i,count:u},{total:0,getData:function(t,r){e.queryParams.isreload?e.queryParams.isreload=!1:(e.queryParams.page=r.page(),e.queryParams.rows=r.count(),e.queryParams.total=r.total()),a.queryList(e.queryParams,function(s){var a=s.pagingResult.total;e.queryParams.total=a,r.total(a),t.resolve(s.pagingResult.rows)})}}),e.del=function(t){confirm("确认删除?")!==!1&&(t.isdeling=!0,n.del({id:t.id},function(){e.reload()}))},o.queryFormById({id:r.formid},function(t){e.formtitle=t.formResult.data.title,e.formdtcreate=t.formResult.data.dtCreate,e.formdtupdate=t.formResult.data.dtUpdate,e.formdtpub=t.formResult.data.dtPub,e.formFields=t.formFields})}),app.controller("FormDesignCtrl",function(e,t,r){function s(e,t){var r=/(\|-<span(((?!<span).)*plugins=\"(radios|checkboxs|select)\".*?)>(.*?)<\/span>-\||<(img|input|textarea|select).*?(<\/select>|<\/textarea>|\/>))/gi,s=/(\w+)=\"(.?|.+?)\"/gi,a=/<input.*?\/>/gi;t||(t=0);var o=e,n=new Array,i=new Object,u=0,c=0;e.replace(r,function(r,l,m,d,p,f,g){var v=new Array,y=new Object,h="",w="",b=!1,P=r,q=g?g:p;if("radios"==q||"checkboxs"==q?r=m:"select"==q&&(r=r.replace("|-",""),r=r.replace("-|","")),r.replace(s,function(e,r,s){"name"==r&&("NEWFIELD"==s&&(b=!0,t++,s="data_"+t),h=s),"select"==q&&"value"==r?(y[r]||(y[r]=""),y[r]+=w+s,w=","):y[r]=s;var a=new Object;a[r]=s,v.push(a)}),"checkboxs"==q){r=P,r=r.replace("|-",""),r=r.replace("-|","");var h="checkboxs_"+u;y.parse_name=h,y.name="",y.value="",y.content='<span plugins="checkboxs" valids="'+y.valids+'">';var C="",R="";f.replace(a,function(e){var r=!1,a=new Object;e.replace(s,function(e,s,o){"name"==s?("NEWFIELD"==o&&(r=!0,t++,o="data_"+t),y.name+=C+o,C=","):"value"==s&&(y.value+=R+o,R=","),a[s]=o}),y.options||(y.options=new Array),y.options.push(a),a.checked||(a.checked="");var o=a.checked?'checked="checked"':"";if(y.content+='<input type="checkbox" name="'+a.name+'" value="'+a.value+'" fieldname="'+y.fieldname+a.fieldname+'"'+o+"/>"+a.value+"&nbsp;",r){var n=new Object;n.name=a.name,n.plugins=y.plugins,n.fieldname=y.fieldname+a.fieldname,n.fielddesc=y.orgdesc,n.valids=y.valids,i[a.name]=n}}),y.content+="</span>",e=e.replace(r,y.content),o=o.replace(r,"{"+h+"}"),o=o.replace("{|-",""),o=o.replace("-|}",""),n[c]=y,u++}else if(h){if("radios"==q){r=P,r=r.replace("|-",""),r=r.replace("-|",""),y.value="",y.content='<span plugins="radios" name="'+y.name+'" valids="'+y.valids+'">';var U="";f.replace(a,function(e){var t=new Object;e.replace(s,function(e,r,s){"value"==r&&(y.value+=U+s,U=","),t[r]=s}),t.name=y.name,y.options||(y.options=new Array),y.options.push(t),t.checked||(t.checked="");var r=t.checked?'checked="checked"':"";y.content+='<input type="radio" name="'+y.name+'" value="'+t.value+'"  '+r+"/>"+t.value+"&nbsp;"}),y.content+="</span>"}else y.content=b?r.replace(/NEWFIELD/,h):r;if(e=e.replace(r,y.content),o=o.replace(r,"{"+h+"}"),o=o.replace("{|-",""),o=o.replace("-|}",""),b){var I=new Object;I.name=h,I.plugins=y.plugins,I.orgtype=y.orgtype,I.fieldname=y.fieldname,I.fielddesc=y.orgdesc,I.valids=y.valids,i[I.name]=I}n[c]=y}c++});var l=e.replace(/{\|-/g,"");l=l.replace(/-\|}/g,"");var m=new Object({fields:t,template:e,parse:l,data:n,add_fields:i});return JSON.stringify(m)}t.id&&(e.id=t.id),UE.delEditor("formdesigncontainer");var a=null;a=UE.getEditor("formdesigncontainer",{toolleipi:!0,initialFrameWidth:1024,initialFrameHeight:200,enableAutoSave:!1,enableContextMenu:!0,toolbars:[["fullscreen","undo","redo","|","bold","italic","underline","fontborder","strikethrough","removeformat","|","forecolor","backcolor","insertorderedlist","insertunorderedlist","|","fontfamily","fontsize","|","indent","|","justifyleft","justifycenter","justifyright","justifyjustify","|","link","unlink","|","horizontal","spechars","wordimage","|","inserttable","deletetable","mergecells","splittocells","|"]],wordCount:!1,elementPathEnabled:!1}),a.addListener("ready",function(){t.id&&r.post("formdesign/getformbyid",{id:t.id}).success(function(t){e.title=t.formResult.data.title,a.execCommand("focus"),a.setContent(t.formResult.data.contentSrc)})}),e.exec=function(e){a.execCommand(e)},e.save=function(){if(0!=confirm("确认保存?注意：保存之后原始表单以及对应表单已上报数据会清空。")){if(a.queryCommandState("source")&&a.execCommand("source"),void 0===e.title)return void alert("标题不能为空");if(e.title.length>50)return void alert("标题长度不能大于50个字符");if(a.hasContents()){a.sync();var t=a.getContent(),o=JSON.parse(s(t,0));e.issaving=!0,r.post("formdesign/add",{title:e.title,content:o.parse,contentSrc:t,fields:JSON.stringify(o.add_fields),id:e.id}).success(function(t){"0"==t.formResult.success?alert(t.formResult.message):(e.id=t.formResult.data,alert("保存成功")),e.issaving=!1}).error(function(){alert("保存失败"),e.issaving=!1})}else alert("内容不能为空")}},e.preview=function(){if(a.queryCommandState("source")&&a.execCommand("source"),!a.hasContents())return alert("内容不能为空！"),!1;a.sync();var t=a.getContent(),r=s(t,0);e.designZone=JSON.parse(r).parse,e.isDesignZoneActive=!0}}),app.controller("FormDesignListCtrl",function(e,t,r,s,a){e.reset=function(){e.searchTitle=null,e.dtCreateBegin=null,e.dtCreateEnd=null,e.dtPubBegin=null,e.dtPubEnd=null,e.ispub=null,e.pubtype=null};var o=1,n=10;e.queryParams={page:o,rows:n,isreload:!0},e.reload=function(){e.queryParams={page:e.queryParams.page,rows:e.queryParams.rows,dtcreate_begin:e.dtCreateBegin,dtcreate_end:e.dtCreateEnd,dtpub_begin:e.dtPubBegin,dtpub_end:e.dtPubEnd,ispub:e.ispub,title:e.searchTitle,pubtype:e.pubtype,isreload:!0},e.tableParams.reload()},e.tableParams=new r({page:o,count:n},{total:0,getData:function(t,r){e.queryParams.isreload?e.queryParams.isreload=!1:(e.queryParams.page=r.page(),e.queryParams.rows=r.count(),e.queryParams.total=r.total()),s.queryList(e.queryParams,function(s){var a=s.pagingResult.total;e.queryParams.total=a,r.total(a),t.resolve(s.pagingResult.rows)})}}),e.pub=function(t,r){a.pub({id:t,type:r},function(){e.reload()})},e.canclepub=function(t){a.canclepub({id:t},function(){e.reload()})},e.del=function(t){confirm("确认删除?")!==!1&&(t.isdeling=!0,a.del({id:t.id},function(){e.reload()}))}}),app.factory("FormDataListService",["$http",function(e){return{queryList:function(t,r){e.post("formdesign/getformdatas",t).success(function(e){var t=[],s=e.pagingResult.rows;if(s&&s.length>0)for(var a in s){var o=s[a];t.push({id:o.id,dt_create:o.dt_create,form_data:JSON.parse(o.form_data)})}e.pagingResult.rows=t,r&&r(e)})}}}]),app.factory("FormDataService",["$http",function(e){return{del:function(t,r){e.post("formdesign/formdatadel",t).success(function(e){r&&r(e)})}}}]),app.factory("FormDesignListService",["$http",function(e){return{queryList:function(t,r){e.post("formdesign/getforms",t).success(function(e){r&&r(e)})}}}]),app.factory("FormDesignService",["$http",function(e){return{queryFormById:function(t,r){e.post("formdesign/getformbyid",t).success(function(e){var t=JSON.parse(e.formResult.data.fields),s=[],a=5,o=0;$.each(t,function(e,t){return o>=a?!1:(o++,void(t&&t.fielddesc&&s.push({name:e,desc:t.fielddesc})))}),e.formFields=s,r&&r(e)})},del:function(t,r){e.post("formdesign/del",t).success(function(e){r&&r(e)})},pub:function(t,r){e.post("formdesign/pub",t).success(function(e){r&&r(e)})},canclepub:function(t,r){e.post("formdesign/canclepub",t).success(function(e){r&&r(e)})}}}]),app.controller("CustomMgrInCustomCtrl",function(e,t,r,s,a,o){function n(){t.post("custom/getCommuns",{customId:c}).success(function(t){e.communs=t})}function i(r){u()&&(e.isrequest=!0,t.post("custom/edit",e.custom).success(function(t){e.formresult=t,e.isrequest=!1,r&&r(t)}))}function u(){return $("#customeditform").isHappy({fields:{customName:{required:!0,maxlength:100},industry:{required:!0,maxlength:200}}})}a.menu="custom";var c=r.id;e.isReady=!1,c?t.post("custom/getCustomById",{id:c}).success(function(r){e.custom=r.custom,e.communs=r.communs,e.attachs=r.attachs,e.isReady=!0,t.post("team/getSelectTeams",{ids:e.custom.team}).success(function(t){e.teamselect=t})}):(e.isReady=!0,e.custom={state:"潜在客户"},t.post("team/getSelectTeams",{}).success(function(t){e.teamselect=t})),e.delCommun=function(r){t.post("custom/delCommun",{id:r.id}).success(function(t){e.formresult=t,n()})},e.save=function(){i(function(e){"1"==e.success&&o.path("custommgr/list")})},e.saveAndAddContract=function(){i(function(e){if("1"==e.success){var t=e.data;o.path("contractmgr/incontract/"+t)}})}}),app.controller("CustomMgrListCtrl",function(e,t,r,s,a){a.menu="custom";var o=1,n=10;e.search={},e.queryParams={rows:n},e.initParams=function(t){var r=o;t&&(r=e.queryParams.page);var s={page:r,rows:e.queryParams.rows,isreload:!0};angular.extend(s,e.search),angular.extend(e.queryParams,s)},e.initParams(),e.reload=function(t){e.initParams(t),e.tableParams.reload()},e.tableParams=new s({page:o,count:n},{total:0,getData:function(r,s){e.queryParams.isreload?e.queryParams.isreload=!1:(e.queryParams.page=s.page(),e.queryParams.rows=s.count(),e.queryParams.total=s.total()),t.post("custom/list",e.queryParams).success(function(t){var a=t.total;e.queryParams.total=a,s.total(a),s.page(e.queryParams.page),r.resolve(t.rows)})}}),e.$watch("search",function(t,r){t!=r&&e.reload()},!0),e.del=function(r){t.post("custom/del",{id:r.id}).success(function(t){e.formresult=t,e.reload(!0)})},e.changeSelect=function(e){$(e).siblings().removeClass("select"),$(e).addClass("select")}}),app.controller("CustomMgrViewCustomCtrl",function(e,t,r,s,a){a.menu="custom";var o=r.id;e.isReady=!1,t.post("custom/getCustomViewById",{id:o}).success(function(t){e.custom=t.custom,e.comms=t.comms,e.attas=t.attas,e.jobs=t.jobs,e.teams=t.teams,t.contracts&&t.contracts.length>0&&(e.contract=t.contracts[0]),e.contractAttas=t.contractAttas,e.isReady=!0}),e.addComm=function(){}}),app.controller("InvoiceMgrInInvoiceCtrl",function(e,t,r,s,a){a.menu="invoice"}),app.controller("InvoiceMgrListCtrl",function(e,t,r,s,a){a.menu="invoice"}),app.controller("InvoiceMgrViewInvoiceCtrl",function(e,t,r,s,a){a.menu="invoice"}),app.factory("InvoiceService",["$http",function(e){return{test:function(t,r){e.post("formdesign/formdatadel",t).success(function(e){r&&r(e)})}}}]),app.controller("JobMgrInJobCtrl",function(e,t,r,s,a){function o(r){n()&&(e.isrequest=!0,e.job.customId=e.custom.id,t.post("job/edit",e.job).success(function(t){e.formresult=t,e.isrequest=!1,r&&r(t)}))}function n(){return $("#jobeditform").isHappy({fields:{}})}a.menu="job";var i=r.id;e.isReady=!1,i?t.post("job/getJobViewById",{id:i}).success(function(r){e.job=r.job,e.custom=r.custom,e.isReady=!0,t.post("team/getSelectTeams",{ids:e.job.team}).success(function(t){e.teamselect=t})}):(e.isReady=!0,e.job={state:"运作",sexLimit:"不限"},t.post("team/getSelectTeams",{ids:""}).success(function(t){e.teamselect=t})),e.save=function(){o(function(e){"1"==e.success&&$location.path("jobmgr/list")})}}),app.controller("JobMgrListCtrl",function(e,t,r,s,a){a.menu="job";var o=1,n=10;e.search={},e.queryParams={rows:n},e.initParams=function(t){var r=o;t&&(r=e.queryParams.page);var s={page:r,rows:e.queryParams.rows,isreload:!0};angular.extend(s,e.search),angular.extend(e.queryParams,s)},e.initParams(),e.reload=function(t){e.initParams(t),e.tableParams.reload()},e.tableParams=new s({page:o,count:n},{total:0,getData:function(r,s){e.queryParams.isreload?e.queryParams.isreload=!1:(e.queryParams.page=s.page(),e.queryParams.rows=s.count(),e.queryParams.total=s.total()),t.post("job/list",e.queryParams).success(function(t){var a=t.total;e.queryParams.total=a,s.total(a),s.page(e.queryParams.page),r.resolve(t.rows)})}}),e.$watch("search",function(t,r){t!=r&&e.reload()},!0),e.del=function(r){t.post("job/del",{id:r.id}).success(function(t){e.formresult=t,e.reload(!0)})},e.changeSelect=function(e){$(e).siblings().removeClass("select"),$(e).addClass("select")}}),app.controller("JobMgrViewJobCtrl",function(e,t,r,s,a){a.menu="job";var o=r.id;e.isReady=!1,t.post("job/getJobViewById",{id:o}).success(function(t){e.job=t.job,e.custom=t.custom,e.inteamresumes=t.inteamresumes,e.pubresumes=t.pubresumes,e.isReady=!0}),e.updateInteamsResumes=function(){},e.updatePubResumes=function(){},e.addComm=function(){}}),app.factory("JobService",["$http",function(e){return{test:function(t,r){e.post("formdesign/formdatadel",t).success(function(e){r&&r(e)})}}}]),app.controller("PerformanceMgrListCtrl",function(e,t,r,s,a,o){o.menu="performance"}),app.factory("PerformanceService",["$http",function(e){return{test:function(t,r){e.post("formdesign/formdatadel",t).success(function(e){r&&r(e)})}}}]),app.controller("ResumeMgrInResumeCtrl",function(e,t,r,s,a){function o(t,r){var s=[],a=e[t];for(var o in a){var n=a[o];n.id!=r&&s.push(n)}e[t]=s}a.menu="resume";var n=r.id;e.isReady=!1,n?t.post("resume/getResumeViewById",{id:n}).success(function(t){e.resume=t.resume;var r=t.target;if(r&&r.length>0){var s=r[0];e.target={id:s.id,resumeId:s.resume_id,targetType:s.target_type,targetPlace:s.target_place,targetJob:s.target_job,targetIndustry:s.target_industry,targetPay:s.target_pay,workState:s.work_state}}e.resumeDatas=t.resumeDatas,e.resumeEdus=t.resumeEdus,e.resumeJobs=t.resumeJobs,e.resumeLanguages=t.resumeLanguages,e.resumeWorkhistorys=t.resumeWorkhistorys,e.isReady=!0}):e.isReady=!0,e.saveBaseInfo=function(r){$("#resumeeditform-baseinfo").isHappy({fields:{}})&&(e.isrequest=!0,t.post("resume/saveBaseinfo",e.resume).success(function(t){e.formresult=t,e.isrequest=!1,"1"==t.success&&r&&(e.show="target",e.resume=t.data)}))},e.saveTarget=function(r){$("#resumeeditform-target").isHappy({fields:{}})&&(e.isrequest=!0,e.target.resumeId=e.resume.id,t.post("resume/saveTarget",e.target).success(function(t){e.formresult=t,e.isrequest=!1,"1"==t.success&&r&&(e.show="workhistory")}))},e.saveWorkHistory=function(r){$("#resumeeditform-workhistory").isHappy({fields:{}})&&(e.isrequest=!0,e.workhistory.resumeId=e.resume.id,t.post("resume/saveWorkHistory",e.workhistory).success(function(t){if(e.formresult=t,e.isrequest=!1,"1"==t.success){var s=t.data;e.resumeWorkhistorys.push({id:s.id,resume_id:s.resumeId,time_begin:s.timeBegin,time_end:s.timeEnd,content:s.content}),e.workhistory={},r&&(e.show="eduhistory")}}))},e.delWorkHistory=function(r){t.post("resume/delWorkHistory",{id:r}).success(function(t){e.formresult=t,e.isrequest=!1,"1"==t.success&&o("resumeWorkhistorys",r)})},e.saveEduHistory=function(r){$("#resumeeditform-eduhistory").isHappy({fields:{}})&&(e.isrequest=!0,e.eduhistory.resumeId=e.resume.id,t.post("resume/saveEduHistory",e.eduhistory).success(function(t){if(e.formresult=t,e.isrequest=!1,"1"==t.success){var s=t.data;e.resumeEdus.push({id:s.id,resume_id:s.resumeId,time_begin:s.timeBegin,time_end:s.timeEnd,org:s.org,course:s.course,content:s.content}),e.eduhistory={},r&&(e.show="language")}}))},e.delEduHistory=function(r){t.post("resume/delEduHistory",{id:r}).success(function(t){e.formresult=t,e.isrequest=!1,"1"==t.success&&o("resumeEdus",r)})},e.saveLanguage=function(r){$("#resumeeditform-language").isHappy({fields:{}})&&(e.isrequest=!0,e.language.resumeId=e.resume.id,t.post("resume/saveLanguage",e.language).success(function(t){if(e.formresult=t,e.isrequest=!1,"1"==t.success){var s=t.data;e.resumeLanguages.push({id:s.id,resume_id:s.resumeId,lan_type:s.lanType,read_ab:s.readAb,listen_ab:s.listenAb,content:s.content}),e.language={},r&&(e.show="icon")}}))},e.delLanguage=function(r){t.post("resume/delLanguage",{id:r}).success(function(t){e.formresult=t,e.isrequest=!1,"1"==t.success&&o("resumeLanguages",r)})},e.saveIcon=function(r){$("#resumeeditform-icon").isHappy({fields:{}})&&(e.isrequest=!0,t.post("resume/saveIcon",{id:e.resume.id,iconPath:e.iconPath}).success(function(t){e.formresult=t,e.isrequest=!1,"1"==t.success&&r&&(e.show="atta")}))},e.uploadAttas=function(){$("#resumeeditform-atta").isHappy({fields:{}})&&(e.isrequest=!0,t.post("resume/uploadAttas",{id:e.resume.id,attas:e.attas}).success(function(t){e.formresult=t,e.isrequest=!1}))}}),app.controller("ResumeMgrListCtrl",function(e,t,r,s,a){a.menu="resume";var o=1,n=10;e.search={},e.queryParams={rows:n},e.initParams=function(t){var r=o;t&&(r=e.queryParams.page);var s={page:r,rows:e.queryParams.rows,isreload:!0};angular.extend(s,e.search),angular.extend(e.queryParams,s)},e.initParams(),e.reload=function(t){e.initParams(t),e.tableParams.reload()},e.tableParams=new s({page:o,count:n},{total:0,getData:function(r,s){e.queryParams.isreload?e.queryParams.isreload=!1:(e.queryParams.page=s.page(),e.queryParams.rows=s.count(),e.queryParams.total=s.total()),t.post("resume/list",e.queryParams).success(function(t){var a=t.total;e.queryParams.total=a,s.total(a),s.page(e.queryParams.page),r.resolve(t.rows)})}}),e.$watch("search",function(t,r){t!=r&&e.reload()},!0),e.del=function(r){t.post("resume/del",{id:r.id}).success(function(t){e.formresult=t,e.reload(!0)})}}),app.controller("ResumeMgrViewResumeCtrl",function(e,t,r,s,a){function o(t,r){var s=[],a=e[t];for(var o in a){var n=a[o];n.id!=r&&s.push(n)}e[t]=s}a.menu="resume";var n=r.id;e.isReady=!1,t.post("resume/getResumeViewById",{id:n}).success(function(t){e.resume=t.resume;var r=t.target;if(r&&r.length>0){var s=r[0];e.target={id:s.id,resumeId:s.resume_id,targetType:s.target_type,targetPlace:s.target_place,targetJob:s.target_job,targetIndustry:s.target_industry,targetPay:s.target_pay,workState:s.work_state}}e.resumeDatas=t.resumeDatas,e.resumeEdus=t.resumeEdus,e.resumeJobs=t.resumeJobs,e.resumeLanguages=t.resumeLanguages,e.resumeWorkhistorys=t.resumeWorkhistorys,e.resumeComms=t.resumeComms,e.isReady=!0}),e.addComm=function(){t.post("resume/addComm",{resumeId:e.resume.id,content:e.addcomm}).success(function(t){if(e.formresult=t,e.isrequest=!1,"1"==t.success){var r=t.data;e.resumeComms.push({id:r.id,resume_id:r.resumeId,content:r.content,create_time:r.createTime})}})},e.delComm=function(r){t.post("resume/delComm",{id:r}).success(function(t){e.formresult=t,e.isrequest=!1,"1"==t.success&&o("resumeComms",r)})}}),app.factory("ResumeService",["$http",function(e){return{test:function(t,r){e.post("formdesign/formdatadel",t).success(function(e){r&&r(e)})}}}]),app.controller("PubMgrInPubCtrl",function(e,t,r,s,a){a.menu="pub"}),app.controller("PubMgrListCtrl",function(e,t,r,s,a){a.menu="pub"}),app.factory("PubService",["$http",function(e){return{test:function(t,r){e.post("formdesign/formdatadel",t).success(function(e){r&&r(e)})}}}]),app.controller("TeamMgrListCtrl",function(e,t,r,s,a){a.menu="team"}),app.controller("TeamMgrMyInfoCtrl",function(e,t,r,s,a){a.menu="team"}),app.controller("UserMgrEditUserCtrl",function(e,t,r,s,a){t.id?(a.nav=s.geNav([["用户管理","/usermgr/list"],["用户编辑"]]),e.id=t.id,r.post("usermgr/getUserById",{id:e.id}).success(function(t){t.createTime=null,t.updateTime=null,e.user=t})):(a.nav=s.geNav([["用户管理","/usermgr/list"],["用户新增"]]),s.getUserInfo(function(t){e.user={userType:"1"==t.userType?"2":"3"}})),e.saveUser=function(){e.formresult=null;var t=$("#usermgr-list-form").isHappy({fields:{loginName:{required:!0,maxlength:20,minlength:6,username:!0},userName:{required:!0,maxlength:20},birthday:{dateISO:!0},orgCode:{required:!0,maxlength:40},department:{required:!0,maxlength:100},comment:{maxlength:100}}});t&&(e.isrequest=!0,r.post("usermgr/editUser",e.user).success(function(t){e.formresult=t,t.data&&(e.user.id=t.data.id),e.isrequest=!1}))}}),app.controller("UserMgrInUserCtrl",function(e,t,r,s,a){a.menu="user"}),app.controller("UserMgrListCtrl",function(e,t,r,s,a,o){a.nav=o.geNav([["用户管理"]]);var n=1,i=10;e.queryParams={page:n,rows:i,isreload:!0},e.reload=function(){e.queryParams={page:e.queryParams.page,rows:e.queryParams.rows,username:e.searchUserName,loginname:e.searchLoginName,usertype:e.searchUserType,isDisabled:e.searchIsDisabled,isreload:!0},e.tableParams.reload()
},e.tableParams=new s({page:n,count:i},{total:0,getData:function(t,s){e.queryParams.isreload?e.queryParams.isreload=!1:(e.queryParams.page=s.page(),e.queryParams.rows=s.count(),e.queryParams.total=s.total()),r.post("usermgr/getUserList",e.queryParams).success(function(r){var a=r.total;e.queryParams.total=a,s.total(a),t.resolve(r.rows)})}}),e.delUser=function(t){confirm("确认删除?")!==!1&&r.post("usermgr/delUser",{id:t.id}).success(function(){e.reload()})},e.disabledUser=function(t){confirm("确认锁定?")!==!1&&r.post("usermgr/disabledUser",{id:t.id}).success(function(){e.reload()})},e.enableUser=function(t){r.post("usermgr/enableUser",{id:t.id}).success(function(){e.reload()})},e.resetPwd=function(t){confirm("确认重置用户密码?")!==!1&&r.post("usermgr/pwdReset",{id:t.id}).success(function(t){e.reload(),e.formresult=t})}}),app.controller("UserMgrViewUserCtrl",function(e,t,r,s,a){a.menu="user"}),app.controller("UserPwdResetCtrl",function(e,t,r,s){s.nav=r.geNav([["用户"],["修改密码"]]),e.resetPwd=function(){e.formresult=null;var r=$("#user-pwdreset-form").isHappy({fields:{oldPwd:{required:!0,pwd:!0},newPwd:{required:!0,pwd:!0},newPwdRepeat:{required:!0,pwd:!0}}});r&&(e.isrequest=!0,t.post("user/pwdReset",e.pwd).success(function(t){e.formresult=t,e.isrequest=!1}))}}),app.controller("UserResetPwdCtrl",function(e,t,r,s,a){a.menu="resetpwd"}),app.factory("UserService",["$http",function(e){return{test:function(t,r){e.post("formdesign/formdatadel",t).success(function(e){r&&r(e)})}}}]),app.controller("UserMgrEditUserCtrl",function(e,t,r,s){t.id?(e.id=t.id,r.post("usermgr/getUserById",{id:e.id}).success(function(t){t.createTime=null,t.updateTime=null,e.user=t})):s.getUserInfo(function(t){e.user={userType:"1"==t.userType?"2":"3"}}),e.saveUser=function(){e.formresult=null;var t=$("#usermgr-list-form").isHappy({fields:{loginName:{required:!0,maxlength:20},userName:{required:!0,maxlength:20},birthday:{dateISO:!0},orgCode:{maxlength:40},department:{maxlength:100},comment:{maxlength:100}}});t&&(e.isrequest=!0,r.post("usermgr/editUser",e.user).success(function(t){e.formresult=t,t.data&&(e.user.id=t.data.id),e.isrequest=!1}))}}),app.controller("UserMgrListCtrl",function(e,t,r,s){var a=1,o=10;e.queryParams={page:a,rows:o,isreload:!0},e.reload=function(){e.queryParams={page:e.queryParams.page,rows:e.queryParams.rows,username:e.searchUserName,loginname:e.searchLoginName,usertype:e.searchUserType,isDisabled:e.searchIsDisabled,isreload:!0},e.tableParams.reload()},e.tableParams=new s({page:a,count:o},{total:0,getData:function(t,s){e.queryParams.isreload?e.queryParams.isreload=!1:(e.queryParams.page=s.page(),e.queryParams.rows=s.count(),e.queryParams.total=s.total()),r.post("usermgr/getUserList",e.queryParams).success(function(r){var a=r.total;e.queryParams.total=a,s.total(a),t.resolve(r.rows)})}}),e.delUser=function(t){confirm("确认删除?")!==!1&&r.post("usermgr/delUser",{id:t.id}).success(function(){e.reload()})},e.disabledUser=function(t){confirm("确认锁定?")!==!1&&r.post("usermgr/disabledUser",{id:t.id}).success(function(){e.reload()})},e.enableUser=function(t){r.post("usermgr/enableUser",{id:t.id}).success(function(){e.reload()})}}),app.factory("TeamService",["$http",function(e){return{test:function(t,r){e.post("formdesign/formdatadel",t).success(function(e){r&&r(e)})}}}]);