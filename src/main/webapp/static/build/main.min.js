"use strict";var app=angular.module("app",["ngRoute","ngTable","datepicker"],function(e){e.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8";var t=function(e){var r,a,s,o,n,i,c,u="";for(r in e)if(a=e[r],a instanceof Array)for(c=0;c<a.length;++c)n=a[c],s=r+"["+c+"]",i={},i[s]=n,u+=t(i)+"&";else if(a instanceof Object)for(o in a)n=a[o],s=r+"["+o+"]",i={},i[s]=n,u+=t(i)+"&";else void 0!==a&&null!==a&&(u+=encodeURIComponent(r)+"="+encodeURIComponent(a)+"&");return u.length?u.substr(0,u.length-1):u};e.defaults.transformRequest=[function(e){return angular.isObject(e)&&"[object File]"!==String(e)?t(e):e}]}),reloadPageFlag=!1;app.factory("redirectInterceptor",["$location","$q",function(e,t){return function(e){return e.then(function(e){return"string"==typeof e.data&&e.data.indexOf instanceof Function&&-1!=e.data.indexOf('<html id="ng-app" ng-app="loginApp">')&&(window.location="/"),e},function(e){return t.reject(e)}),e}}]),app.factory("ajaxHandler",["$q","$rootScope",function(e,t){var r={responseError:function(r){var a=r.status,s="";switch(parseInt(a)){case 400:s="请求错误";break;case 401:var o=3;s="登陆超时,"+o+"秒后自动跳转登陆页面...",reloadPageFlag||(reloadPageFlag=!0,setTimeout(function(){window.location.reload()},1e3*o));break;case 403:s="无访问权限";break;case 404:s="未知请求";break;case 500:s="操作失败,服务器异常";break;case 302:var o=3;s="登陆超时,"+o+"秒后自动跳转登陆页面...",reloadPageFlag||(reloadPageFlag=!0,setTimeout(function(){window.location.reload()},1e3*o));break;case 0:s="无法连接服务器";break;default:s="未知错误"}return t.ajaxerror={success:0,message:s,time:new Date},e.reject(r)}};return r}]),app.config(["$httpProvider",function(e){e.interceptors.push("redirectInterceptor"),e.interceptors.push("ajaxHandler")}]),app.controller("MainCtrl",function(e,t,r){e.to=function(e){t.path(e)},r.post("user/getLoginUserInfo",{}).success(function(t){e.user=t,window.LOGINUSER=t})});var fdRouterViewsBasepath="static/app/modules/";app.config(["$routeProvider",function(e){e.when("/",{templateUrl:fdRouterViewsBasepath+"index/views/index.html",controller:"IndexCtrl"}).when("/custommgr/list",{templateUrl:fdRouterViewsBasepath+"custom/views/custommgrlist.html",controller:"CustomMgrListCtrl"}).when("/custommgr/list/:who",{templateUrl:fdRouterViewsBasepath+"custom/views/custommgrlist.html",controller:"CustomMgrListCtrl"}).when("/custommgr/incustom",{templateUrl:fdRouterViewsBasepath+"custom/views/custommgrincustom.html",controller:"CustomMgrInCustomCtrl"}).when("/custommgr/editcustom/:id",{templateUrl:fdRouterViewsBasepath+"custom/views/custommgrincustom.html",controller:"CustomMgrInCustomCtrl"}).when("/custommgr/viewcustom/:id",{templateUrl:fdRouterViewsBasepath+"custom/views/custommgrviewcustom.html",controller:"CustomMgrViewCustomCtrl"}).when("/jobmgr/list",{templateUrl:fdRouterViewsBasepath+"job/views/jobmgrlist.html",controller:"JobMgrListCtrl"}).when("/jobmgr/list/:who",{templateUrl:fdRouterViewsBasepath+"job/views/jobmgrlist.html",controller:"JobMgrListCtrl"}).when("/jobmgr/injob",{templateUrl:fdRouterViewsBasepath+"job/views/jobmgrinjob.html",controller:"JobMgrInJobCtrl"}).when("/jobmgr/injob/:customId",{templateUrl:fdRouterViewsBasepath+"job/views/jobmgrinjob.html",controller:"JobMgrInJobCtrl"}).when("/jobmgr/editjob/:id",{templateUrl:fdRouterViewsBasepath+"job/views/jobmgrinjob.html",controller:"JobMgrInJobCtrl"}).when("/jobmgr/viewjob/:id",{templateUrl:fdRouterViewsBasepath+"job/views/jobmgrviewjob.html",controller:"JobMgrViewJobCtrl"}).when("/resumemgr/list",{templateUrl:fdRouterViewsBasepath+"resume/views/resumemgrlist.html",controller:"ResumeMgrListCtrl"}).when("/resumemgr/inresume",{templateUrl:fdRouterViewsBasepath+"resume/views/resumemgrinresume.html",controller:"ResumeMgrInResumeCtrl"}).when("/resumemgr/editresume/:id",{templateUrl:fdRouterViewsBasepath+"resume/views/resumemgrinresume.html",controller:"ResumeMgrInResumeCtrl"}).when("/resumemgr/viewresume/:id",{templateUrl:fdRouterViewsBasepath+"resume/views/resumemgrviewresume.html",controller:"ResumeMgrViewResumeCtrl"}).when("/resumemgr/pub/:id",{templateUrl:fdRouterViewsBasepath+"resume/views/resumepublist.html",controller:"ResumePubListCtrl"}).when("/contractmgr/list",{templateUrl:fdRouterViewsBasepath+"contract/views/contractmgrlist.html",controller:"ContractMgrListCtrl"}).when("/contractmgr/incontract",{templateUrl:fdRouterViewsBasepath+"contract/views/contractmgrincontract.html",controller:"ContractMgrInContractCtrl"}).when("/contractmgr/incontract/:customId",{templateUrl:fdRouterViewsBasepath+"contract/views/contractmgrincontract.html",controller:"ContractMgrInContractCtrl"}).when("/contractmgr/editcontract/:id",{templateUrl:fdRouterViewsBasepath+"contract/views/contractmgrincontract.html",controller:"ContractMgrInContractCtrl"}).when("/contractmgr/viewcontract/:id",{templateUrl:fdRouterViewsBasepath+"contract/views/contractmgrviewcontract.html",controller:"ContractMgrViewContractCtrl"}).when("/invoicemgr/list",{templateUrl:fdRouterViewsBasepath+"invoice/views/invoicemgrlist.html",controller:"InvoiceMgrListCtrl"}).when("/invoicemgr/ininvoice",{templateUrl:fdRouterViewsBasepath+"invoice/views/invoicemgrininvoice.html",controller:"InvoiceMgrInInvoiceCtrl"}).when("/invoicemgr/editcustom/:id",{templateUrl:fdRouterViewsBasepath+"invoice/views/invoicemgrininvoice.html",controller:"InvoiceMgrInInvoiceCtrl"}).when("/invoicemgr/viewinvoice/:id",{templateUrl:fdRouterViewsBasepath+"custom/views/invoicemgrviewinvoice.html",controller:"InvoiceMgrViewInvoiceCtrl"}).when("/performancemgr/list",{templateUrl:fdRouterViewsBasepath+"performance/views/performancemgrlist.html",controller:"PerformanceMgrListCtrl"}).when("/teammgr/list",{templateUrl:fdRouterViewsBasepath+"team/views/teammgrlist.html",controller:"TeamMgrListCtrl"}).when("/teammgr/myinfo",{templateUrl:fdRouterViewsBasepath+"team/views/teammgrmyinfo.html",controller:"TeamMgrMyInfoCtrl"}).when("/usermgr/list",{templateUrl:fdRouterViewsBasepath+"user/views/usermgrlist.html",controller:"UserMgrListCtrl"}).when("/usermgr/inuser",{templateUrl:fdRouterViewsBasepath+"user/views/usermgrinuser.html",controller:"UserMgrInUserCtrl"}).when("/usermgr/editcustom/:id",{templateUrl:fdRouterViewsBasepath+"user/views/usermgrinuser.html",controller:"UserMgrInUserCtrl"}).when("/usermgr/viewuser/:id",{templateUrl:fdRouterViewsBasepath+"user/views/usermgrviewuser.html",controller:"UserMgrViewUserCtrl"}).when("/usermgr/resetpwd",{templateUrl:fdRouterViewsBasepath+"user/views/userresetpwd.html",controller:"UserResetPwdCtrl"}).when("/usermgr/uploadicon",{templateUrl:fdRouterViewsBasepath+"user/views/uploadicon.html",controller:"UserUploadIconCtrl"}).when("/pubmgr/list",{templateUrl:fdRouterViewsBasepath+"pub/views/pubmgrlist.html",controller:"PubMgrListCtrl"}).when("/pubmgr/inpub",{templateUrl:fdRouterViewsBasepath+"pub/views/pubmgrinpub.html",controller:"PubMgrInPubCtrl"}).when("/pubmgr/editpub",{templateUrl:fdRouterViewsBasepath+"pub/views/pubmgreditpub.html",controller:"PubMgrEditPubCtrl"}).when("/codemgr",{templateUrl:fdRouterViewsBasepath+"code/views/codemgr.html",controller:"CodeMgrCtrl"}).otherwise({redirectTo:"/"})}]),app.filter("trustHtml",function(e){return function(t){return e.trustAsHtml(t)}}),app.directive("coreBasedata",["$http",function($http){var baseData={};baseData.inyear=[];for(var yearCount=8,currentYear=(new Date).getFullYear(),i=0;yearCount>i;i++)baseData.inyear.push([""+(currentYear-i),""+(currentYear-i)+"年"]);return $.ajax({url:"getAllCodes",async:!1,success:function(data){data=eval(data);for(var i in data){var item=data[i],type=item.codetype,value=item.codevalue;baseData[type]||(baseData[type]=[]),baseData[type].push([value,value])}}}),{restrict:"A",scope:{value:"@value",type:"@type",key:"@key",name:"@dataname",bindModel:"=",allSelectName:"@allSelectName"},templateUrl:"static/app/components/directives/core/views/basedata.html",replace:!0,require:"?ngModel",link:function(e,t,r,a){e.items=baseData[e.key],e.click=function(e,t){if(a.$setViewValue(e),t){var r=$(t);r.siblings().removeClass("select"),r.addClass("select")}},e.select=function(t){e.bindModel=t.bindModel}}}}]),app.directive("coreContractresumeselect",["$http",function(e){return{restrict:"A",replace:!0,scope:{finalval:"=finalval"},require:"ngModel",templateUrl:"static/app/components/directives/core/views/contractresumeselect.html",link:function(t,r,a,s){var o=!1;t.ok=function(e){var r=e.resume_name+" - "+e.job_name;t.finalval=r,s.$setViewValue({resumeId:e.rid,resumeDesc:r})},t.$watch("finalval",function(e){e&&(o||(o=!0,t.finalval=e))},!0),t.$watch("customcontractsearch",function(r,a){r!=a&&e.post("invoice/getContractResume",{no:t.customcontractsearch.no,jobName:t.customcontractsearch.jobName,resumeName:t.customcontractsearch.resumeName,page:1,rows:100}).success(function(e){t.items=e.rows})},!0),e.post("invoice/getContractResume",{page:1,rows:100}).success(function(e){t.items=e.rows})}}}]),app.directive("coreCustomcontractselect",["$http",function(e){return{restrict:"A",replace:!0,scope:{finalval:"=finalval"},require:"ngModel",templateUrl:"static/app/components/directives/core/views/customcontractselect.html",link:function(t,r,a,s){var o=!1;t.ok=function(e){var r=e.custom_name+"(合同编号："+e.no+")";t.finalval=r,s.$setViewValue({customId:e.custom_id,contractNo:e.no,customContract:r})},t.$watch("finalval",function(e){e&&(o||(o=!0,t.finalval=e))},!0),t.$watch("customcontractsearch",function(r,a){r!=a&&e.post("invoice/getCustomContract",{companyName:t.customcontractsearch.companyName,no:t.customcontractsearch.no,page:1,rows:100}).success(function(e){t.items=e.rows})},!0),e.post("invoice/getCustomContract",{page:1,rows:100}).success(function(e){t.items=e.rows})}}}]),app.directive("coreCustomselect",["$http",function(e){return{restrict:"A",replace:!0,scope:{customid:"=customid"},require:"ngModel",templateUrl:"static/app/components/directives/core/views/customselect.html",link:function(t,r,a,s){var o=!1;t.ok=function(e){t.customname=e.custom_name,s.$setViewValue(e)},t.$watch("customid",function(r){r&&(o||(o=!0,e.post("custom/getCustomById",{id:r}).success(function(e){e.custom&&(t.customname=e.custom.customName)})))},!0),t.$watch("customsearch",function(r,a){r!=a&&e.post("custom/list",{companyName:r,page:1,rows:100,beyond:"my",customStatus:"签约运作"}).success(function(e){t.customs=e.rows})},!0),e.post("custom/list",{page:1,rows:100,beyond:"my",customStatus:"签约运作"}).success(function(e){t.customs=e.rows})}}}]),app.directive("coreFileupload",["$http",function(e){return{restrict:"A",scope:{attas:"=attas"},require:"?ngModel",templateUrl:"static/app/components/directives/core/views/fileupload.html",link:function(t,r,a,s){function o(e){var t="";if(e&&e.length>0)for(var r=0;r<e.length;r++)t+=e[r].id,r!=e.length-1&&(t+=",");return t}function n(e){var r=[];for(var a in t.attas){var s=t.attas[a];s.id!=e&&r.push(s)}t.attas=r}t.$watch("attaresult",function(){var e=t.attaresult;t.attaformresult=e,e&&"1"==e.success&&(t.attas||(t.attas=[]),t.attas.push(e.data),s.$setViewValue(o(t.attas)))}),t.delAttach=function(r){e.post("fileDel",{id:r.id}).success(function(e){t.attaformresult=e,n(r.id),s.$setViewValue(o(t.attas))})}}}}]),app.directive("coreFormresult",["$timeout",function(e){var t=null;return{restrict:"A",scope:{formresult:"=result"},templateUrl:"static/app/components/directives/core/views/formresult.html",link:function(r){r.$watch("formresult",function(){null!=r.formresult&&"1"==r.formresult.success&&(e.cancel(t),t=e(function(){r.formresult=null},4e3),r.$on("$destroy",function(){e.cancel(t)}))})}}}]),app.directive("coreFu",["$http",function(){return{restrict:"A",require:"?ngModel",link:function(e,t,r,a){var s={dataType:"json",url:"fileUpload"};s.started=function(){e.$apply(function(){a.$setViewValue({success:"0",message:"上传中..."})})},s.done=function(t,r){e.$apply(function(){a.$setViewValue(r.result)})},s.fail=function(){e.$apply(function(){a.$setViewValue({success:"0",message:"上传失败"})})},t.fileupload(s)}}}]),app.directive("corePermission",["BaseInfoService",function(e){return{restrict:"A",link:function(t,r,a){var s=r.style.display;r.style.display="none",e.getUserInfo(function(e){var t=!1,o=!1,n=e.userType;if("1"!=n){var i=a.roles.split(",");if(i.length>0)for(var c in i){var u=i[c];if(u==n){t=!0;break}}{a.funid}o=!0,t&&o&&(r.style.display=s)}else r.style.display=s})}}}]),app.directive("coreTeamselect",["$http",function(e){return{restrict:"A",replace:!0,scope:{teamids:"=teamids",single:"=single",name:"@dataname"},require:"ngModel",templateUrl:"static/app/components/directives/core/views/teamselect.html",link:function(t,r,a,s){function o(){var e=[],r=t.select;for(var a in r)e.push(r[a].id);t.selectteamsFlag=e.join(","),s.$setViewValue(e.join(","))}var n=t.single?t.single:!1,i=!1;t.addItem=function(e){t.select||(t.select=[]),n&&(t.select=[]),t.select.push(e),o()},t.removeItem=function(e,r){t.select.splice(r,1),o()},t.$watch("teamids",function(r){r&&(i||(i=!0,e.post("team/getSelectTeams",{ids:r}).success(function(e){t.select=e;var r=[];for(var a in e)r.push(e[a].id);t.selectteamsFlag=r.join(",")})))},!0),t.$watch("teamsearch",function(r,a){r!=a&&e.post("team/list",{name:r,page:1,rows:100}).success(function(e){t.teams=e.rows})},!0),e.post("team/list",{page:1,rows:100}).success(function(e){t.teams=e.rows})}}}]),angular.module("datepicker",[]).directive("datepicker",[function(){return{restrict:"A",require:"ngModel",link:function(e,t,r,a){$(function(){var s="yy-mm-dd";r.format&&(s=r.format);var o={dateFormat:s,changeMonth:!0,changeYear:!0,showButtonPanel:!0,onSelect:function(t){e.$apply(function(){a.$setViewValue(t)})}};"yy-mm"==s&&(o.closeText="确定",o.onClose=function(){if("yy-mm"==s){var t=$("#ui-datepicker-div .ui-datepicker-month :selected").val(),r=$("#ui-datepicker-div .ui-datepicker-year :selected").val();$(this).datepicker("setDate",new Date(r,t,1)),e.$apply(function(){t&&1==t.length&&(t="0"+t),a.$setViewValue(r+"-"+t)})}}),o.currentText="今天",t.datepicker(o),t.focus(function(){"yy-mm"==s?$(".ui-datepicker-calendar").hide():$(".ui-datepicker-calendar").show()});var n=$('<i class="fa fa-refresh hover"></i>').click(function(){t.val(""),e.$apply(function(){a.$setViewValue("")})});t.after(n)})}}}]),app.factory("BaseInfoService",["$http","ngTableParams",function(e,t){var r=null;return{getUserInfo:function(t){r?data&&t(data):e.post("getLoginUser").success(function(e){e&&t(e)})},pageSearch:function(r){var a=r.$scope,s=r.params,o=r.url,n=r.page;void 0==n&&(n=10);r.items;s||(a[s]={});var i=new t({page:0,count:n},{total:0,getData:function(t,r){a[s].isreload?a[s].isreload=!1:(a[s].page=r.page(),a[s].rows=r.count(),a[s].total=r.total()),e.post(o,a[s]).success(function(e){var o=e.total;a[s].total=o,r.total(o),t.resolve(e.rows)})}});return i}}}]),app.controller("CodeMgrCtrl",function(e,t,r,a,s){s.menu="codemgr",e.search={queryParams:{}},t.post("code/getCodeTypes",{}).success(function(t){e.items=t,e.search.queryParams.codetype="customIndustry"}),e.reload=function(){t.post("code/getCodesByType",e.search.queryParams).success(function(t){e.codes=t})},e.$watch("search",function(t,r){t!=r&&e.reload()},!0),e.del=function(r){t.post("code/del",{codeId:r.id}).success(function(t){e.formresult=t,e.reload()})},e.addCode=function(){return void 0==e.addCodeValue?void(e.formresult={success:!1,message:"值不能为空"}):e.addCodeValue.length>100?void(e.formresult={success:0,message:"长度不能大于100"}):void 0!=e.addCodeRank&&isNaN(e.addCodeRank)?void(e.formresult={success:0,message:"顺序必须为数字"}):void t.post("code/edit",{codetype:e.search.queryParams.codetype,codevalue:e.addCodeValue,rank:e.addCodeRank}).success(function(t){e.formresult=t,e.reload()})}}),app.controller("ContractMgrInContractCtrl",function(e,t,r,a,s,o){function n(r,a){i()&&(e.isrequest=!0,e.contract.customId=e.custom.id,e.contract.isUpdate=r,t.post("contract/edit",e.contract).success(function(t){e.formresult=t,e.isrequest=!1,a&&a(t)}))}function i(){return $("#contracteditform").isHappy({fields:{customName:{required:!0},no:{required:!0,maxlength:100},state:{required:!0,maxlength:50},inDate:{required:!0,date:!0},inPercentage:{required:!0,maxlength:100},payway:{required:!0,maxlength:100},firstPay:{required:!0,number:!0},useLimit:{required:!0,maxlength:50},otherRequire:{maxlength:500}}})}s.menu="contract";var c=r.id,u=r.customId;e.isReady=!1,u&&t.post("custom/getCustomById",{id:u}).success(function(t){e.custom=t.custom,e.isReady=!0}),c&&t.post("contract/getContractViewById",{id:c}).success(function(t){e.custom=t.custom,e.contract=t.contract,e.attachs=t.attachs,e.isReady=!0}),c||u||(e.isReady=!0),e.save=function(e){n(e,function(e){"1"==e.success&&o.path(c?"contractmgr/viewcontract/"+c:"contractmgr/list")})}}),app.controller("ContractMgrListCtrl",function(e,t,r,a,s){s.menu="contract";var o=1,n=10;e.search={},e.queryParams={rows:n},e.initParams=function(t){var r=o;t&&(r=e.queryParams.page);var a={page:r,rows:e.queryParams.rows,isreload:!0};angular.extend(a,e.search),angular.extend(e.queryParams,a)},e.initParams(),e.reload=function(t){e.initParams(t),e.tableParams.reload()},e.tableParams=new a({page:o,count:n},{total:0,getData:function(r,a){e.queryParams.isreload?e.queryParams.isreload=!1:(e.queryParams.page=a.page(),e.queryParams.rows=a.count(),e.queryParams.total=a.total()),t.post("contract/list",e.queryParams).success(function(t){var s=t.total;e.queryParams.total=s,a.total(s),a.page(e.queryParams.page),r.resolve(t.rows)})}}),e.$watch("search",function(t,r){t!=r&&e.reload()},!0),e.del=function(r){t.post("contract/del",{id:r.id}).success(function(t){e.formresult=t,e.reload(!0)})}}),app.controller("ContractMgrViewContractCtrl",function(e,t,r,a,s){s.menu="contract";var o=r.id;e.isReady=!1,t.post("contract/getContractViewById",{id:o}).success(function(t){e.custom=t.custom,e.contract=t.contract,e.jobs=t.jobs,e.contractAttas=t.attachs,e.beyond=t.beyond,e.isReady=!0})}),app.factory("ContractService",["$http",function(e){return{test:function(t,r){e.post("formdesign/formdatadel",t).success(function(e){r&&r(e)})}}}]),app.controller("CustomMgrInCustomCtrl",function(e,t,r,a,s,o){function n(){t.post("custom/getCommuns",{customId:u}).success(function(t){e.communs=t})}function i(r){c()&&(e.isrequest=!0,t.post("custom/edit",e.custom).success(function(t){e.formresult=t,e.isrequest=!1,r&&r(t)}))}function c(){return $("#customeditform").isHappy({fields:{customName:{required:!0,maxlength:100},industry:{required:!0,maxlength:200},team:{required:!0},contactName:{required:!0,maxlength:100},contactDuty:{required:!0,maxlength:100},contactLandline:{required:!0,maxlength:100},contactCellphone:{maxlength:100},contactFax:{maxlength:100},contactEmail:{required:!0,email:!0,maxlength:100},contactQq:{maxlength:100},contactWeixin:{maxlength:100},contactAddress:{maxlength:200},contactWebsite:{required:!0,maxlength:100},companyProfile:{maxlength:100},commun:{maxlength:500}}})}s.menu="custom";var u=r.id;e.isReady=!1,u?t.post("custom/getCustomById",{id:u}).success(function(t){e.custom=t.custom,e.communs=t.communs,e.attachs=t.attachs,e.isReady=!0}):(e.isReady=!0,e.custom={state:"潜在客户"}),e.delCommun=function(r){t.post("custom/delCommun",{id:r.id}).success(function(t){e.formresult=t,n()})},e.save=function(){i(function(e){"1"==e.success&&o.path("custommgr/viewcustom/"+u)})},e.saveAndAddContract=function(){i(function(e){if("1"==e.success){var t=e.data;o.path("contractmgr/incontract/"+t)}})}}),app.controller("CustomMgrListCtrl",function(e,t,r,a,s){s.menu="custom",e.search={},e.changeSelect=function(e){$(e).siblings().removeClass("select"),$(e).addClass("select")};var o=r.who;o&&(e.search.beyond=o,e.changeSelect($("#beyond-my")));var n=1,i=10;e.queryParams={rows:i},e.initParams=function(t){var r=n;t&&(r=e.queryParams.page);var a={page:r,rows:e.queryParams.rows,isreload:!0};angular.extend(a,e.search),angular.extend(e.queryParams,a)},e.initParams(),e.reload=function(t){e.initParams(t),e.tableParams.reload()},e.tableParams=new a({page:n,count:i},{total:0,getData:function(r,a){e.queryParams.isreload?e.queryParams.isreload=!1:(e.queryParams.page=a.page(),e.queryParams.rows=a.count(),e.queryParams.total=a.total()),t.post("custom/list",e.queryParams).success(function(t){var s=t.total;e.queryParams.total=s,a.total(s),a.page(e.queryParams.page),r.resolve(t.rows)})}}),e.$watch("search",function(t,r){t!=r&&e.reload()},!0),e.del=function(r){t.post("custom/del",{id:r.id}).success(function(t){e.formresult=t,e.reload(!0)})}}),app.controller("CustomMgrViewCustomCtrl",function(e,t,r,a,s){s.menu="custom";var o=r.id;e.isReady=!1,e.reload=function(){t.post("custom/getCustomViewById",{id:o}).success(function(t){e.custom=t.custom,e.comms=t.comms?t.comms:[],e.attas=t.attas,e.jobs=t.jobs,e.teams=t.teams,e.beyond=t.beyond,t.contracts&&t.contracts.length>0&&(e.contract=t.contracts[0]),e.contractAttas=t.contractAttas,e.isReady=!0,e.contentInfo=""})},e.reload(),e.addComm=function(){$("#addCommForm").isHappy({fields:{addContent:{required:!0,maxlength:500}}})&&t.post("custom/addCommun",{customId:e.custom.id,content:e.contentInfo}).success(function(t){e.reload(),e.formresult=t})}}),app.controller("FormDataListCtrl",function(e,t,r,a,s,o,n){var i=1,c=10;e.initParams=function(){e.queryParams={page:i,rows:c,formid:r.formid,isreload:!0}},e.initParams(),e.reload=function(){e.initParams(),e.tableParams.reload()},e.tableParams=new a({page:i,count:c},{total:0,getData:function(t,r){e.queryParams.isreload?e.queryParams.isreload=!1:(e.queryParams.page=r.page(),e.queryParams.rows=r.count(),e.queryParams.total=r.total()),s.queryList(e.queryParams,function(a){var s=a.pagingResult.total;e.queryParams.total=s,r.total(s),t.resolve(a.pagingResult.rows)})}}),e.del=function(t){confirm("确认删除?")!==!1&&(t.isdeling=!0,n.del({id:t.id},function(){e.reload()}))},o.queryFormById({id:r.formid},function(t){e.formtitle=t.formResult.data.title,e.formdtcreate=t.formResult.data.dtCreate,e.formdtupdate=t.formResult.data.dtUpdate,e.formdtpub=t.formResult.data.dtPub,e.formFields=t.formFields})}),app.controller("FormDesignCtrl",function(e,t,r){function a(e,t){var r=/(\|-<span(((?!<span).)*plugins=\"(radios|checkboxs|select)\".*?)>(.*?)<\/span>-\||<(img|input|textarea|select).*?(<\/select>|<\/textarea>|\/>))/gi,a=/(\w+)=\"(.?|.+?)\"/gi,s=/<input.*?\/>/gi;t||(t=0);var o=e,n=new Array,i=new Object,c=0,u=0;e.replace(r,function(r,l,m,d,p,f,g){var h=new Array,v=new Object,y="",w="",b=!1,q=r,P=g?g:p;if("radios"==P||"checkboxs"==P?r=m:"select"==P&&(r=r.replace("|-",""),r=r.replace("-|","")),r.replace(a,function(e,r,a){"name"==r&&("NEWFIELD"==a&&(b=!0,t++,a="data_"+t),y=a),"select"==P&&"value"==r?(v[r]||(v[r]=""),v[r]+=w+a,w=","):v[r]=a;var s=new Object;s[r]=a,h.push(s)}),"checkboxs"==P){r=q,r=r.replace("|-",""),r=r.replace("-|","");var y="checkboxs_"+c;v.parse_name=y,v.name="",v.value="",v.content='<span plugins="checkboxs" valids="'+v.valids+'">';var C="",I="";f.replace(s,function(e){var r=!1,s=new Object;e.replace(a,function(e,a,o){"name"==a?("NEWFIELD"==o&&(r=!0,t++,o="data_"+t),v.name+=C+o,C=","):"value"==a&&(v.value+=I+o,I=","),s[a]=o}),v.options||(v.options=new Array),v.options.push(s),s.checked||(s.checked="");var o=s.checked?'checked="checked"':"";if(v.content+='<input type="checkbox" name="'+s.name+'" value="'+s.value+'" fieldname="'+v.fieldname+s.fieldname+'"'+o+"/>"+s.value+"&nbsp;",r){var n=new Object;n.name=s.name,n.plugins=v.plugins,n.fieldname=v.fieldname+s.fieldname,n.fielddesc=v.orgdesc,n.valids=v.valids,i[s.name]=n}}),v.content+="</span>",e=e.replace(r,v.content),o=o.replace(r,"{"+y+"}"),o=o.replace("{|-",""),o=o.replace("-|}",""),n[u]=v,c++}else if(y){if("radios"==P){r=q,r=r.replace("|-",""),r=r.replace("-|",""),v.value="",v.content='<span plugins="radios" name="'+v.name+'" valids="'+v.valids+'">';var x="";f.replace(s,function(e){var t=new Object;e.replace(a,function(e,r,a){"value"==r&&(v.value+=x+a,x=","),t[r]=a}),t.name=v.name,v.options||(v.options=new Array),v.options.push(t),t.checked||(t.checked="");var r=t.checked?'checked="checked"':"";v.content+='<input type="radio" name="'+v.name+'" value="'+t.value+'"  '+r+"/>"+t.value+"&nbsp;"}),v.content+="</span>"}else v.content=b?r.replace(/NEWFIELD/,y):r;if(e=e.replace(r,v.content),o=o.replace(r,"{"+y+"}"),o=o.replace("{|-",""),o=o.replace("-|}",""),b){var R=new Object;R.name=y,R.plugins=v.plugins,R.orgtype=v.orgtype,R.fieldname=v.fieldname,R.fielddesc=v.orgdesc,R.valids=v.valids,i[R.name]=R}n[u]=v}u++});var l=e.replace(/{\|-/g,"");l=l.replace(/-\|}/g,"");var m=new Object({fields:t,template:e,parse:l,data:n,add_fields:i});return JSON.stringify(m)}t.id&&(e.id=t.id),UE.delEditor("formdesigncontainer");var s=null;s=UE.getEditor("formdesigncontainer",{toolleipi:!0,initialFrameWidth:1024,initialFrameHeight:200,enableAutoSave:!1,enableContextMenu:!0,toolbars:[["fullscreen","undo","redo","|","bold","italic","underline","fontborder","strikethrough","removeformat","|","forecolor","backcolor","insertorderedlist","insertunorderedlist","|","fontfamily","fontsize","|","indent","|","justifyleft","justifycenter","justifyright","justifyjustify","|","link","unlink","|","horizontal","spechars","wordimage","|","inserttable","deletetable","mergecells","splittocells","|"]],wordCount:!1,elementPathEnabled:!1}),s.addListener("ready",function(){t.id&&r.post("formdesign/getformbyid",{id:t.id}).success(function(t){e.title=t.formResult.data.title,s.execCommand("focus"),s.setContent(t.formResult.data.contentSrc)})}),e.exec=function(e){s.execCommand(e)},e.save=function(){if(0!=confirm("确认保存?注意：保存之后原始表单以及对应表单已上报数据会清空。")){if(s.queryCommandState("source")&&s.execCommand("source"),void 0===e.title)return void alert("标题不能为空");if(e.title.length>50)return void alert("标题长度不能大于50个字符");if(s.hasContents()){s.sync();var t=s.getContent(),o=JSON.parse(a(t,0));e.issaving=!0,r.post("formdesign/add",{title:e.title,content:o.parse,contentSrc:t,fields:JSON.stringify(o.add_fields),id:e.id}).success(function(t){"0"==t.formResult.success?alert(t.formResult.message):(e.id=t.formResult.data,alert("保存成功")),e.issaving=!1}).error(function(){alert("保存失败"),e.issaving=!1})}else alert("内容不能为空")}},e.preview=function(){if(s.queryCommandState("source")&&s.execCommand("source"),!s.hasContents())return alert("内容不能为空！"),!1;s.sync();var t=s.getContent(),r=a(t,0);e.designZone=JSON.parse(r).parse,e.isDesignZoneActive=!0}}),app.controller("FormDesignListCtrl",function(e,t,r,a,s){e.reset=function(){e.searchTitle=null,e.dtCreateBegin=null,e.dtCreateEnd=null,e.dtPubBegin=null,e.dtPubEnd=null,e.ispub=null,e.pubtype=null};var o=1,n=10;e.queryParams={page:o,rows:n,isreload:!0},e.reload=function(){e.queryParams={page:e.queryParams.page,rows:e.queryParams.rows,dtcreate_begin:e.dtCreateBegin,dtcreate_end:e.dtCreateEnd,dtpub_begin:e.dtPubBegin,dtpub_end:e.dtPubEnd,ispub:e.ispub,title:e.searchTitle,pubtype:e.pubtype,isreload:!0},e.tableParams.reload()},e.tableParams=new r({page:o,count:n},{total:0,getData:function(t,r){e.queryParams.isreload?e.queryParams.isreload=!1:(e.queryParams.page=r.page(),e.queryParams.rows=r.count(),e.queryParams.total=r.total()),a.queryList(e.queryParams,function(a){var s=a.pagingResult.total;e.queryParams.total=s,r.total(s),t.resolve(a.pagingResult.rows)})}}),e.pub=function(t,r){s.pub({id:t,type:r},function(){e.reload()})},e.canclepub=function(t){s.canclepub({id:t},function(){e.reload()})},e.del=function(t){confirm("确认删除?")!==!1&&(t.isdeling=!0,s.del({id:t.id},function(){e.reload()}))}}),app.factory("FormDataListService",["$http",function(e){return{queryList:function(t,r){e.post("formdesign/getformdatas",t).success(function(e){var t=[],a=e.pagingResult.rows;if(a&&a.length>0)for(var s in a){var o=a[s];t.push({id:o.id,dt_create:o.dt_create,form_data:JSON.parse(o.form_data)})}e.pagingResult.rows=t,r&&r(e)})}}}]),app.factory("FormDataService",["$http",function(e){return{del:function(t,r){e.post("formdesign/formdatadel",t).success(function(e){r&&r(e)})}}}]),app.factory("FormDesignListService",["$http",function(e){return{queryList:function(t,r){e.post("formdesign/getforms",t).success(function(e){r&&r(e)})}}}]),app.factory("FormDesignService",["$http",function(e){return{queryFormById:function(t,r){e.post("formdesign/getformbyid",t).success(function(e){var t=JSON.parse(e.formResult.data.fields),a=[],s=5,o=0;$.each(t,function(e,t){return o>=s?!1:(o++,void(t&&t.fielddesc&&a.push({name:e,desc:t.fielddesc})))}),e.formFields=a,r&&r(e)})},del:function(t,r){e.post("formdesign/del",t).success(function(e){r&&r(e)})},pub:function(t,r){e.post("formdesign/pub",t).success(function(e){r&&r(e)})},canclepub:function(t,r){e.post("formdesign/canclepub",t).success(function(e){r&&r(e)})}}}]),app.controller("IndexCtrl",function(e,t,r,a,s){s.menu="#",e.isRequest=!0,t.post("index/getIndex",{}).success(function(t){e.data=t,e.isRequest=!1})}),app.controller("InvoiceMgrInInvoiceCtrl",function(e,t,r,a,s,o){function n(r){i()&&(e.isrequest=!0,e.invoice.customId=e.invoice.cc.customId,e.invoice.contractNo=e.invoice.cc.contractNo,e.invoice.resumeId=e.invoice.rd.resumeId,e.invoice.resumeDesc=e.invoice.rd.resumeDesc,t.post("invoice/edit",e.invoice).success(function(t){e.formresult=t,e.isrequest=!1,r&&r(t)}))}function i(){return $("#invoiceeditform").isHappy({fields:{team:{required:!0},checkUser:{required:!0},applyTime:{required:!0,date:!0},customContract:{required:!0,maxlength:100},type:{required:!0,maxlength:50},property:{required:!0,maxlength:100},total:{required:!0,number:!0},state:{required:!0,maxlength:100},incomeState:{required:!0,maxlength:50},comment:{maxlength:500}}})}s.menu="invoice";var c=r.id;e.isReady=!1,e.USER=LOGINUSER,c?t.post("invoice/getInvoiceViewById",{id:c}).success(function(t){e.invoice=t.invoice,e.applyUserDesc=t.applyUserDesc,e.invoice.cc={customId:t.invoice.customId,contractNo:t.invoice.contractNo},e.invoice.rd={resumeId:t.invoice.resumeId,resumeDesc:t.invoice.resumeDesc},e.isReady=!0}):e.isReady=!0,e.delCommun=function(r){t.post("invoice/del",{id:r.id}).success(function(t){e.formresult=t})},e.save=function(){n(function(t){e.formresult=t,"1"==t.success&&o.path("/invoicemgr/list")})}}),app.controller("InvoiceMgrListCtrl",function(e,t,r,a,s){s.menu="invoice",t.post("invoice/isCanInvoice",{}).success(function(t){e.isCanInvoice=t.isCanInvoice});var o=1,n=10;e.search={},e.queryParams={rows:n},e.initParams=function(t){var r=o;t&&(r=e.queryParams.page);var a={page:r,rows:e.queryParams.rows,isreload:!0};angular.extend(a,e.search),angular.extend(e.queryParams,a)},e.initParams(),e.reload=function(t){e.initParams(t),e.tableParams.reload()},e.tableParams=new a({page:o,count:n},{total:0,getData:function(r,a){e.queryParams.isreload?e.queryParams.isreload=!1:(e.queryParams.page=a.page(),e.queryParams.rows=a.count(),e.queryParams.total=a.total()),t.post("invoice/list",e.queryParams).success(function(t){var s=t.total;e.queryParams.total=s,a.total(s),a.page(e.queryParams.page),r.resolve(t.rows)})}}),e.$watch("search",function(t,r){t!=r&&e.reload()},!0),e.del=function(r){t.post("invoice/del",{id:r.id}).success(function(t){e.formresult=t,e.reload(!0)})}}),app.controller("InvoiceMgrViewInvoiceCtrl",function(e,t,r,a,s){s.menu="invoice";var o=r.id;e.isReady=!1,t.post("invoice/getInvoiceViewById",{id:o}).success(function(t){e.invoice=t.invoice,e.isReady=!0})}),app.controller("JobMgrInJobCtrl",function(e,t,r,a,s,o){function n(r){i()&&(e.isrequest=!0,e.job.customId=e.custom.id,t.post("job/edit",e.job).success(function(t){e.formresult=t,e.isrequest=!1,r&&r(t)}))}function i(){return $("#jobeditform").isHappy({fields:{customName:{required:!0,maxlength:500},name:{required:!0,maxlength:100},payMin:{number:!0},payMax:{number:!0},state:{required:!0},team:{required:!0},workplace:{required:!0,maxlength:200},jobType:{required:!0,maxlength:100},industry:{required:!0,maxlength:200},workYear:{required:!0,digits:!0},requirePeople:{required:!0,digits:!0},department:{required:!0,maxlength:100},reportObj:{required:!0,maxlength:100},ageMin:{required:!0,digits:!0},ageMax:{required:!0,digits:!0},languageLimit:{maxlength:100},jobDesc:{required:!0,maxlength:500},companyDesc:{required:!0,maxlength:500}}})}s.menu="job";var c=r.id,u=r.customId;
e.isReady=!1,c?t.post("job/getJobViewById",{id:c}).success(function(t){e.job=t.job,e.custom=t.custom,e.isReady=!0}):u?(t.post("custom/getCustomById",{id:u}).success(function(t){e.custom=t.custom,e.isReady=!0}),e.job={state:"运作",sexLimit:"不限"}):(e.isReady=!0,e.job={state:"运作",sexLimit:"不限"}),e.save=function(){n(function(e){"1"==e.success&&o.path(u?"custommgr/viewcustom/"+u:"jobmgr/viewjob/"+c)})}}),app.controller("JobMgrListCtrl",function(e,t,r,a,s){s.menu="job",e.search={},e.changeSelect=function(e){$(e).siblings().removeClass("select"),$(e).addClass("select")};var o=r.who;o&&(e.search.beyond=o,e.changeSelect($("#beyond-my")));var n=1,i=10;e.queryParams={rows:i},e.initParams=function(t){var r=n;t&&(r=e.queryParams.page);var a={page:r,rows:e.queryParams.rows,isreload:!0};angular.extend(a,e.search),angular.extend(e.queryParams,a)},e.initParams(),e.reload=function(t){e.initParams(t),e.tableParams.reload()},e.tableParams=new a({page:n,count:i},{total:0,getData:function(r,a){e.queryParams.isreload?e.queryParams.isreload=!1:(e.queryParams.page=a.page(),e.queryParams.rows=a.count(),e.queryParams.total=a.total()),t.post("job/list",e.queryParams).success(function(t){var s=t.total;e.queryParams.total=s,a.total(s),a.page(e.queryParams.page),r.resolve(t.rows)})}}),e.$watch("search",function(t,r){t!=r&&e.reload()},!0),e.del=function(r){t.post("job/del",{id:r.id}).success(function(t){e.formresult=t,e.reload(!0)})}}),app.controller("JobMgrViewJobCtrl",function(e,t,r,a,s){function o(e){var t={},r=0,a=0;return e&&e.length>0&&$.each(e,function(e,s){t[s.verify_state]=s.cou,r+=s.cou,s.verify_state||(a+=s.cou)}),t.all=r,t.notHandle=a,t.mianshi=n(t["初试"])+n(t["复试"])+n(t["终试"]),t.pass=n(t["面试不通过"])+n(t["审核不通过"])+n(t["候选人放弃"]),t.ok=n(t.offer)+n(t["入职"]),t}function n(e){return null===e||void 0===e||""===e?0:e}s.menu="job";var i=r.id;e.isReady=!1;var c=function(){e.isReady=!1,t.post("job/getJobViewById",{id:i}).success(function(t){e.job=t.job,e.custom=t.custom,e.inteams=t.inteamresumes,e.pubresumes=t.pubresumes,e.jobcomms=t.jobcomms,e.jobcommsFile=t.jobcommsFile,e.beyond=t.beyond,e.jobTeamDesc=t.jobTeamDesc,e.jobrecstate=o(t.jobrecstate),e.isReady=!0})};c(),e.pubResume=function(r){t.post("job/pubResume",{rjId:r}).success(function(t){e.formresult=t,1==t.success&&c()})},e.cancleResume=function(r){t.post("job/cancleResume",{rjId:r}).success(function(t){e.formresult=t,1==t.success&&c()})},e.verify=function(r,a){t.post("job/verifyResume",{rjId:r,status:a}).success(function(t){e.formresult=t,1==t.success&&c()})},e.addComm=function(){t.post("job/editJobComm",{jobId:i,content:e.addcomm}).success(function(t){e.formresult=t,1==t.success&&c()})},e.delComm=function(r){t.post("job/delJobComm",{id:r}).success(function(t){e.formresult=t,1==t.success&&c()})},e.loadRJComm=function(r){e.rjResumeId=r,e.addRJCommContent=null,e.comms=null,t.post("job/loadRJComm",{id:r}).success(function(t){e.comms=t,e.showcommdialog=!0,e.editRJCommID=r})},e.addRJComm=function(){t.post("job/editRJComm",{resumejobId:e.rjResumeId,content:e.addRJCommContent}).success(function(t){e.loadRJComm(e.rjResumeId),e.formresult=t})},e.delRJComm=function(r){t.post("job/delRJComm",{id:r}).success(function(t){e.formresult=t,e.loadRJComm(e.rjResumeId)})},e.addCommFile=function(){t.post("job/addCommFile",{ids:e.addcommFile,jobId:i}).success(function(t){e.formresult=t,1==t.success&&(c(),e.addcommFile=null,e.attachs=null)})},e.delCommFile=function(r){t.post("fileDel",{id:r}).success(function(t){e.formresult=t,1==t.success&&c()})}}),app.factory("JobService",["$http",function(e){return{test:function(t,r){e.post("formdesign/formdatadel",t).success(function(e){r&&r(e)})}}}]),app.controller("PerformanceMgrListCtrl",function(e,t,r,a,s,o){o.menu="performance";var n=1,i=10;e.search={},e.queryParams={rows:i},e.initParams=function(t){var r=n;t&&(r=e.queryParams.page);var a={page:r,rows:e.queryParams.rows,isreload:!0};angular.extend(a,e.search),angular.extend(e.queryParams,a)},e.initParams(),e.reload=function(t){e.initParams(t),e.tableParams.reload()},e.tableParams=new a({page:n,count:i},{total:0,getData:function(r,a){e.queryParams.isreload?e.queryParams.isreload=!1:(e.queryParams.page=a.page(),e.queryParams.rows=a.count(),e.queryParams.total=a.total()),t.post("performance/list",e.queryParams).success(function(t){var s=t.total;e.queryParams.total=s,a.total(s),a.page(e.queryParams.page),r.resolve(t.rows)})}}),e.$watch("search",function(t,r){t!=r&&e.reload()},!0)}),app.factory("PerformanceService",["$http",function(e){return{test:function(t,r){e.post("formdesign/formdatadel",t).success(function(e){r&&r(e)})}}}]),app.controller("PubMgrInPubCtrl",function(e,t,r,a,s){s.menu="pub"}),app.controller("PubMgrListCtrl",function(e,t,r,a,s){s.menu="pub";var o=1,n=10;e.search={},e.queryParams={rows:n},e.initParams=function(t){var r=o;t&&(r=e.queryParams.page);var a={page:r,rows:e.queryParams.rows,isreload:!0};angular.extend(a,e.search),angular.extend(e.queryParams,a)},e.initParams(),e.reload=function(t){e.initParams(t),e.tableParams.reload()},e.tableParams=new a({page:o,count:n},{total:0,getData:function(r,a){e.queryParams.isreload?e.queryParams.isreload=!1:(e.queryParams.page=a.page(),e.queryParams.rows=a.count(),e.queryParams.total=a.total()),t.post("pub/list",e.queryParams).success(function(t){var s=t.total;e.queryParams.total=s,a.total(s),a.page(e.queryParams.page),r.resolve(t.rows)})}}),e.$watch("search",function(t,r){t!=r&&e.reload()},!0),e.del=function(r){t.post("pub/del",{id:r.id}).success(function(t){e.formresult=t,e.reload(!0)})},e.add=function(){$("#form-pub").isHappy({fields:{addcontent:{required:!0,maxlength:500}}})&&t.post("pub/edit",{content:e.addcontent}).success(function(t){e.addcontent=null,e.formresult=t,e.reload(!0)})},e.pub=function(r){t.post("pub/pubp",{id:r.id}).success(function(t){e.formresult=t,e.reload(!0)})},e.canclepub=function(r){t.post("pub/canclepub",{id:r.id}).success(function(t){e.formresult=t,e.reload(!0)})}}),app.factory("PubService",["$http",function(e){return{test:function(t,r){e.post("formdesign/formdatadel",t).success(function(e){r&&r(e)})}}}]),app.controller("ResumeMgrInResumeCtrl",function(e,t,r,a,s){function o(t,r){var a=[],s=e[t];for(var o in s){var n=s[o];n.id!=r&&a.push(n)}e[t]=a}function n(t){if(parseInt(t.w)>0){var r=100/t.w,a=100/t.h;e.icon=t,m.css({width:Math.round(r*u)+"px",height:Math.round(a*l)+"px",marginLeft:"-"+Math.round(r*t.x)+"px",marginTop:"-"+Math.round(a*t.y)+"px"})}}s.menu="resume";var i=r.id;e.isReady=!1,e.target={targetTypeA:{all:!1,part:!1,learn:!1}},i?t.post("resume/getResumeViewById",{id:i}).success(function(t){e.resume=t.resume;var r=t.target;if(r&&r.length>0){var a=r[0];e.target={id:a.id,resumeId:a.resume_id,targetType:a.target_type,targetPlace:a.target_place,targetJob:a.target_job,targetIndustry:a.target_industry,targetPay:a.target_pay,workState:a.work_state},a.target_type&&(e.target.targetTypeA={all:!1,part:!1,learn:!1},-1!=a.target_type.indexOf("全职")&&(e.target.targetTypeA.all=!0),-1!=a.target_type.indexOf("兼职")&&(e.target.targetTypeA.part=!0),-1!=a.target_type.indexOf("实习")&&(e.target.targetTypeA.learn=!0))}e.resumeDatas=t.resumeDatas,e.resumeEdus=t.resumeEdus,e.resumeJobs=t.resumeJobs,e.resumeLanguages=t.resumeLanguages,e.resumeWorkhistorys=t.resumeWorkhistorys,e.isReady=!0}):(e.isReady=!0,e.target={},e.resumeDatas=[],e.resumeEdus=[],e.resumeJobs=[],e.resumeLanguages=[],e.resumeWorkhistorys=[]),e.saveBaseInfo=function(r){$("#resumeeditform-baseinfo").isHappy({fields:{name:{required:!0,maxlength:100},address:{required:!0,maxlength:200},sex:{required:!0,maxlength:10},education:{required:!0,maxlength:100},birthcay:{required:!0,date:!0},marrage:{required:!0,maxlength:20},phone:{required:!0,telephone:!0,maxlength:100},email:{required:!0,email:!0,maxlength:100},yearPay:{required:!0,number:!0},workState:{required:!0,maxlength:50},industry:{maxlength:100},duty:{maxlength:50},desc:{required:!0,maxlength:500}}})&&(e.isrequest=!0,t.post("resume/saveBaseinfo",e.resume).success(function(t){e.formresult=t,e.isrequest=!1,"1"==t.success&&(e.resume.id=t.data.id,r&&(e.show="language"))}))},e.saveTarget=function(r){if($("#resumeeditform-target").isHappy({fields:{worktype:{maxlength:100},targetPlace:{maxlength:100},targetJob:{maxlength:100},targetIndustry:{maxlength:100},targetPay:{maxlength:100},workState:{maxlength:100}}})){e.isrequest=!0,e.target.resumeId=e.resume.id;var a="";e.target.targetTypeA.all&&(a+="全职,"),e.target.targetTypeA.part&&(a+="兼职,"),e.target.targetTypeA.learn&&(a+="实习,"),e.target.targetType=a,t.post("resume/saveTarget",e.target).success(function(t){e.formresult=t,e.isrequest=!1,"1"==t.success&&(e.target.id=t.data.id,r&&(e.show="workhistory"))})}},e.saveWorkHistory=function(r){$("#resumeeditform-workhistory").isHappy({fields:{timeBegin:{required:!0,date:!0},timeEnd:{date:!0},company:{required:!0,maxlength:100},content:{required:!0,maxlength:500},zhiwei:{required:!0,maxlength:100},hangye:{required:!0,maxlength:500}}})&&(e.isrequest=!0,e.workhistory.resumeId=e.resume.id,t.post("resume/saveWorkHistory",e.workhistory).success(function(t){if(e.formresult=t,e.isrequest=!1,"1"==t.success){var a=t.data;e.resumeWorkhistorys.push({id:a.id,resume_id:a.resumeId,time_begin:a.timeBegin,time_end:a.timeEnd,content:a.content,company:a.company,zhiwei:a.zhiwei,hangye:a.hangye}),$("#hangye-tag").find("[name=hangye]").val(""),e.workhistory={},r&&(e.show="icon")}}))},e.delWorkHistory=function(r){t.post("resume/delWorkHistory",{id:r}).success(function(t){e.formresult=t,e.isrequest=!1,"1"==t.success&&o("resumeWorkhistorys",r)})},e.saveEduHistory=function(r){$("#resumeeditform-eduhistory").isHappy({fields:{timeBegin:{required:!0,date:!0},timeEnd:{date:!0},org:{required:!0,maxlength:100},course:{required:!0,maxlength:500}}})&&(e.isrequest=!0,e.eduhistory.resumeId=e.resume.id,t.post("resume/saveEduHistory",e.eduhistory).success(function(t){if(e.formresult=t,e.isrequest=!1,"1"==t.success){var a=t.data;e.resumeEdus.push({id:a.id,resume_id:a.resumeId,time_begin:a.timeBegin,time_end:a.timeEnd,org:a.org,course:a.course,content:a.content}),e.eduhistory={},r&&(e.show="target")}}))},e.delEduHistory=function(r){t.post("resume/delEduHistory",{id:r}).success(function(t){e.formresult=t,e.isrequest=!1,"1"==t.success&&o("resumeEdus",r)})},e.saveLanguage=function(r){$("#resumeeditform-language").isHappy({fields:{lanType:{required:!0,maxlength:100},readAb:{required:!0,maxlength:100},listenAb:{required:!0,maxlength:100},content:{required:!0,maxlength:500}}})&&(e.isrequest=!0,e.language.resumeId=e.resume.id,t.post("resume/saveLanguage",e.language).success(function(t){if(e.formresult=t,e.isrequest=!1,"1"==t.success){var a=t.data;e.resumeLanguages.push({id:a.id,resume_id:a.resumeId,lan_type:a.lanType,read_ab:a.readAb,listen_ab:a.listenAb,content:a.content}),e.language={},r&&(e.show="target")}}))},e.delLanguage=function(r){t.post("resume/delLanguage",{id:r}).success(function(t){e.formresult=t,e.isrequest=!1,"1"==t.success&&o("resumeLanguages",r)})};var c,u,l,m=($("#preview-pane"),$("#preview-pane .preview-container"),$("#preview-pane .preview-container img"));e.$watch("upicondata.data.id",function(){c&&c.destroy(),setTimeout(function(){e.icon={},$("#icon_head").Jcrop({onChange:n,onSelect:n,width:200,height:200,boxWidth:700,aspectRatio:1},function(){c=this;var e=this.getBounds();u=e[0],l=e[1]})},200)},!0),e.saveIcon=function(r){return void 0==e.icon.x?void(e.formresult={success:0,message:"请截取图片"}):void($("#resumeeditform-icon").isHappy({fields:{}})&&(e.isrequest=!0,t.post("resume/saveIcon",{resumeId:e.resume.id,iconId:e.upicondata.data.id,x:parseInt(e.icon.x),y:parseInt(e.icon.y),w:parseInt(e.icon.w),h:parseInt(e.icon.h)}).success(function(t){if(e.formresult=t,e.isrequest=!1,"1"==t.success){var a=t.data;e.resume.headImage=a+"?_="+Math.random(),e.upicondata.data.id=null,r&&(e.show="atta")}})))},e.uploadAttas=function(){$("#resumeeditform-atta").isHappy({fields:{}})&&(e.isrequest=!0,t.post("resume/uploadAttas",{id:e.resume.id,attas:e.attas}).success(function(t){e.formresult=t,e.isrequest=!1}))}}),app.controller("ResumeMgrListCtrl",function(e,t,r,a,s){s.menu="resume",e.changeSelect=function(e){$(e).siblings().removeClass("select"),$(e).addClass("select")};var o=1,n=10;e.search={},e.queryParams={rows:n},e.initParams=function(t){var r=o;t&&(r=e.queryParams.page);var a={page:r,rows:e.queryParams.rows,isreload:!0};angular.extend(a,e.search),angular.extend(e.queryParams,a)},e.initParams(),e.reload=function(t){e.initParams(t),e.tableParams.reload()},e.tableParams=new a({page:o,count:n},{total:0,getData:function(r,a){e.queryParams.isreload?e.queryParams.isreload=!1:(e.queryParams.page=a.page(),e.queryParams.rows=a.count(),e.queryParams.total=a.total()),t.post("resume/list",e.queryParams).success(function(t){var s=t.total;e.queryParams.total=s,a.total(s),a.page(e.queryParams.page),r.resolve(t.rows)})}}),e.$watch("search",function(t,r){t!=r&&e.reload()},!0),e.del=function(r){t.post("resume/del",{id:r.id}).success(function(t){e.formresult=t,e.reload(!0)})}}),app.controller("ResumeMgrViewResumeCtrl",function(e,t,r,a,s){function o(){t.post("resume/getResumeViewById",{id:n}).success(function(t){e.resume=t.resume;var r=t.target;if(r&&r.length>0){var a=r[0];e.target={id:a.id,resumeId:a.resume_id,targetType:a.target_type,targetPlace:a.target_place,targetJob:a.target_job,targetIndustry:a.target_industry,targetPay:a.target_pay,workState:a.work_state}}e.resumeDatas=t.resumeDatas,e.resumeEdus=t.resumeEdus,e.resumeJobs=t.resumeJobs,e.resumeLanguages=t.resumeLanguages,e.resumeWorkhistorys=t.resumeWorkhistorys,e.resumeComms=t.resumeComms,e.beyond=t.beyond,e.isReady=!0})}s.menu="resume";var n=r.id;e.isReady=!1,o(),e.addComm=function(){t.post("resume/addComm",{resumeId:e.resume.id,content:e.addcomm}).success(function(t){e.formresult=t,e.isrequest=!1,o()})},e.delComm=function(r){t.post("resume/delComm",{id:r}).success(function(t){e.formresult=t,e.isrequest=!1,"1"==t.success&&o()})}}),app.controller("ResumePubListCtrl",function(e,t,r,a,s){s.menu="resume";var o=r.id;e.resumeId=o;var n=1,i=10;e.search={},e.queryParams={rows:i},e.initParams=function(t){var r=n;t&&(r=e.queryParams.page);var a={page:r,rows:e.queryParams.rows,isreload:!0};angular.extend(a,e.search),angular.extend(e.queryParams,a)},e.initParams(),e.reload=function(t){e.initParams(t),e.tableParams.reload()},e.tableParams=new a({page:n,count:i},{total:0,getData:function(r,a){e.queryParams.isreload?e.queryParams.isreload=!1:(e.queryParams.page=a.page(),e.queryParams.rows=a.count(),e.queryParams.total=a.total()),t.post("resume/getCustomList",$.extend({},e.queryParams,{resumeId:o})).success(function(t){var s=t.total;e.queryParams.total=s,a.total(s),a.page(e.queryParams.page),r.resolve(t.rows)})}}),e.$watch("search",function(t,r){t!=r&&e.reload()},!0),e.pub=function(r){t.post("resume/pub",{resumeId:o,jobId:r.id}).success(function(t){e.formresult=t,e.reload(!0)})},e.canclePub=function(r){t.post("resume/canclePub",{resumeId:o,jobId:r.id}).success(function(t){e.formresult=t,e.reload(!0)})}}),app.factory("ResumeService",["$http",function(e){return{test:function(t,r){e.post("formdesign/formdatadel",t).success(function(e){r&&r(e)})}}}]),app.controller("TeamMgrListCtrl",function(e,t,r,a,s){s.menu="team";var o=1,n=12;e.search={},e.queryParams={rows:n},e.initParams=function(t){var r=o;t&&(r=e.queryParams.page);var a={page:r,rows:e.queryParams.rows,isreload:!0};angular.extend(a,e.search),angular.extend(e.queryParams,a)},e.initParams(),e.reload=function(t){e.initParams(t),e.tableParams.reload()},e.tableParams=new a({page:o,count:n},{total:0,getData:function(r,a){e.queryParams.isreload?e.queryParams.isreload=!1:(e.queryParams.page=a.page(),e.queryParams.rows=a.count(),e.queryParams.total=a.total()),t.post("team/list",e.queryParams).success(function(t){var s=t.total;e.queryParams.total=s,a.total(s),a.page(e.queryParams.page),r.resolve(t.rows)})}}),e.$watch("search",function(t,r){t!=r&&e.reload()},!0)}),app.controller("TeamMgrMyInfoCtrl",function(e,t,r,a,s){s.menu="team"}),app.controller("UserMgrInUserCtrl",function(e,t,r,a,s,o){s.menu="user",t.id?(e.id=t.id,r.post("user/getUserById",{id:e.id}).success(function(t){t.createTime=null,t.updateTime=null,e.user=t})):a.getUserInfo(function(t){e.user={userType:"1"==t.userType?"2":"3"}}),e.saveUser=function(){e.formresult=null;var t=$("#usermgr-list-form").isHappy({fields:{username:{required:!0,username:!0},userType:{required:!0},name:{required:!0,maxlength:20},sex:{required:!0},duty:{required:!0,maxlength:40},entryDate:{required:!0,dateISO:!0},state:{required:!0},idCard:{idCard:!0},npPlace:{maxlength:200},phone:{required:!0,maxlength:100},eduSchool:{maxlength:200},eduDate:{dateISO:!0},department:{maxlength:100},email:{email:!0},msn:{maxlength:100},education:{maxlength:100},professional:{maxlength:100},positiveDate:{dateISO:!0},leaveDate:{dateISO:!0},skills:{maxlength:200}}});t&&(e.isrequest=!0,r.post("user/editUser",e.user).success(function(t){e.formresult=t,"1"==t.success&&o.path("usermgr/list/")}))}}),app.controller("UserMgrListCtrl",function(e,t,r,a,s){s.menu="user";var o=1,n=10;e.search={},e.queryParams={rows:n},e.initParams=function(t){var r=o;t&&(r=e.queryParams.page);var a={page:r,rows:e.queryParams.rows,isreload:!0};angular.extend(a,e.search),angular.extend(e.queryParams,a)},e.initParams(),e.reload=function(t){e.initParams(t),e.tableParams.reload()},e.tableParams=new a({page:o,count:n},{total:0,getData:function(t,a){e.queryParams.isreload?e.queryParams.isreload=!1:(e.queryParams.page=a.page(),e.queryParams.rows=a.count(),e.queryParams.total=a.total()),r.post("user/getUserList",e.queryParams).success(function(r){var s=r.total;e.queryParams.total=s,a.total(s),a.page(e.queryParams.page),t.resolve(r.rows)})}}),e.$watch("search",function(t,r){t!=r&&e.reload()},!0),e.delUser=function(t){r.post("user/delUser",{id:t.id}).success(function(){e.reload()})},e.disabledUser=function(t){r.post("user/disabledUser",{id:t.id}).success(function(){e.reload()})},e.enableUser=function(t){r.post("user/enableUser",{id:t.id}).success(function(){e.reload()})},e.resetPwd=function(t){confirm("确认重置用户密码?")!==!1&&r.post("user/pwdReset",{id:t.id}).success(function(t){e.reload(),e.formresult=t})}}),app.controller("UserMgrViewUserCtrl",function(e,t,r,a,s){s.menu="user"}),app.controller("UserResetPwdCtrl",function(e,t,r,a){a.menu="resetpwd",e.resetPwd=function(){e.formresult=null;var r=$("#user-pwdreset-form").isHappy({fields:{oldPwd:{required:!0,pwd:!0},newPwd:{required:!0,pwd:!0},newPwdRepeat:{required:!0,pwd:!0}}});r&&(e.isrequest=!0,t.post("user/pwdChange",e.pwd).success(function(t){e.formresult=t,e.isrequest=!1}))}}),app.controller("UserUploadIconCtrl",function(e,t,r,a){function s(t){if(parseInt(t.w)>0){var r=100/t.w,a=100/t.h;e.icon=t,c.css({width:Math.round(r*n)+"px",height:Math.round(a*i)+"px",marginLeft:"-"+Math.round(r*t.x)+"px",marginTop:"-"+Math.round(a*t.y)+"px"})}}a.menu="uploadicon",t.post("user/getLoginUserInfo",{}).success(function(t){e.headImage=t.icon});var o,n,i,c=($("#preview-pane"),$("#preview-pane .preview-container"),$("#preview-pane .preview-container img"));e.$watch("upicondata.data.id",function(){o&&o.destroy(),setTimeout(function(){e.icon={},$("#icon_head").Jcrop({onChange:s,onSelect:s,width:200,height:200,boxWidth:700,aspectRatio:1},function(){o=this;var e=this.getBounds();n=e[0],i=e[1]})},200)},!0),e.saveIcon=function(){return void 0==e.icon.x?void(e.formresult={success:0,message:"请截取图片"}):(e.isrequest=!0,void t.post("user/uploadicon",{iconId:e.upicondata.data.id,x:parseInt(e.icon.x),y:parseInt(e.icon.y),w:parseInt(e.icon.w),h:parseInt(e.icon.h)}).success(function(t){if(e.formresult=t,e.isrequest=!1,"1"==t.success){var r=t.data;e.headImage=r+"?_="+Math.random(),e.upicondata.data.id=null}}))}});