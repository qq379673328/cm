"use strict";var app=angular.module("app",["ngRoute","ngTable"],function(e){e.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8";var t=function(e){var r,n,o,s,a,i,l,c="";for(r in e)if(n=e[r],n instanceof Array)for(l=0;l<n.length;++l)a=n[l],o=r+"["+l+"]",i={},i[o]=a,c+=t(i)+"&";else if(n instanceof Object)for(s in n)a=n[s],o=r+"["+s+"]",i={},i[o]=a,c+=t(i)+"&";else void 0!==n&&null!==n&&(c+=encodeURIComponent(r)+"="+encodeURIComponent(n)+"&");return c.length?c.substr(0,c.length-1):c};e.defaults.transformRequest=[function(e){return angular.isObject(e)&&"[object File]"!==String(e)?t(e):e}]});app.controller("MainCtrl",function(e,t){e.to=function(e){t.path(e)}}),app.controller("IndexCtrl",function(e,t,r){r.menu="#"});var fdRouterViewsBasepath="static/app/modules/";app.config(["$routeProvider",function(e){e.when("/",{templateUrl:fdRouterViewsBasepath+"index/views/index.html",controller:"IndexCtrl"}).when("/custommgr/list",{templateUrl:fdRouterViewsBasepath+"custom/views/custommgrlist.html",controller:"CustomMgrListCtrl"}).when("/custommgr/incustom",{templateUrl:fdRouterViewsBasepath+"custom/views/custommgrincustom.html",controller:"CustomMgrInCustomCtrl"}).when("/custommgr/editcustom/:id",{templateUrl:fdRouterViewsBasepath+"custom/views/custommgrincustom.html",controller:"CustomMgrInCustomCtrl"}).when("/custommgr/viewcustom/:id",{templateUrl:fdRouterViewsBasepath+"custom/views/custommgrviewcustom.html",controller:"CustomMgrViewCustomCtrl"}).when("/jobmgr/list",{templateUrl:fdRouterViewsBasepath+"job/views/jobmgrlist.html",controller:"JobMgrListCtrl"}).when("/jobmgr/injob",{templateUrl:fdRouterViewsBasepath+"job/views/jobmgrinjob.html",controller:"JobMgrInCustomCtrl"}).when("/jobmgr/editjob/:id",{templateUrl:fdRouterViewsBasepath+"job/views/jobmgrinjob.html",controller:"JobMgrInJobCtrl"}).when("/jobmgr/viewjob/:id",{templateUrl:fdRouterViewsBasepath+"custom/views/jobmgrviewjob.html",controller:"JobMgrViewJobCtrl"}).when("/resumemgr/list",{templateUrl:fdRouterViewsBasepath+"resume/views/resumemgrlist.html",controller:"ResumeMgrListCtrl"}).when("/resumemgr/inresume",{templateUrl:fdRouterViewsBasepath+"resume/views/resumemgrinresume.html",controller:"ResumeMgrInResumeCtrl"}).when("/resumemgr/editcustom/:id",{templateUrl:fdRouterViewsBasepath+"resume/views/resumemgrinresume.html",controller:"ResumeMgrInResumeCtrl"}).when("/resumemgr/viewresume/:id",{templateUrl:fdRouterViewsBasepath+"custom/views/resumemgrviewresume.html",controller:"ResumeMgrViewResumeCtrl"}).when("/contractmgr/list",{templateUrl:fdRouterViewsBasepath+"contract/views/contractmgrlist.html",controller:"ContractMgrListCtrl"}).when("/contractmgr/incontract",{templateUrl:fdRouterViewsBasepath+"contract/views/contractmgrincontract.html",controller:"ContractMgrInContractCtrl"}).when("/contractmgr/editcustom/:id",{templateUrl:fdRouterViewsBasepath+"contract/views/contractmgrincontract.html",controller:"ContractMgrInContractCtrl"}).when("/contractmgr/viewcontract/:id",{templateUrl:fdRouterViewsBasepath+"custom/views/contractmgrviewcontract.html",controller:"ContractMgrViewContractCtrl"}).when("/invoicemgr/list",{templateUrl:fdRouterViewsBasepath+"invoice/views/invoicemgrlist.html",controller:"InvoiceMgrListCtrl"}).when("/invoicemgr/ininvoice",{templateUrl:fdRouterViewsBasepath+"invoice/views/invoicemgrininvoice.html",controller:"InvoiceMgrInInvoiceCtrl"}).when("/invoicemgr/editcustom/:id",{templateUrl:fdRouterViewsBasepath+"invoice/views/invoicemgrininvoice.html",controller:"InvoiceMgrInInvoiceCtrl"}).when("/invoicemgr/viewinvoice/:id",{templateUrl:fdRouterViewsBasepath+"custom/views/invoicemgrviewinvoice.html",controller:"InvoiceMgrViewInvoiceCtrl"}).when("/performancemgr/list",{templateUrl:fdRouterViewsBasepath+"performance/views/performancemgrlist.html",controller:"PerformanceMgrListCtrl"}).when("/teammgr/list",{templateUrl:fdRouterViewsBasepath+"team/views/teammgrlist.html",controller:"TeamMgrListCtrl"}).when("/teammgr/myinfo",{templateUrl:fdRouterViewsBasepath+"team/views/teammgrmyinfo.html",controller:"TeamMgrMyInfoCtrl"}).when("/usermgr/list",{templateUrl:fdRouterViewsBasepath+"user/views/usermgrlist.html",controller:"UserMgrListCtrl"}).when("/usermgr/inuser",{templateUrl:fdRouterViewsBasepath+"user/views/usermgrinuser.html",controller:"UserMgrInUserCtrl"}).when("/usermgr/editcustom/:id",{templateUrl:fdRouterViewsBasepath+"user/views/usermgrinuser.html",controller:"UserMgrInUserCtrl"}).when("/usermgr/viewuser/:id",{templateUrl:fdRouterViewsBasepath+"custom/views/usermgrviewuser.html",controller:"UserMgrViewUserCtrl"}).when("/usermgr/resetpwd",{templateUrl:fdRouterViewsBasepath+"user/views/userresetpwd.html",controller:"UserResetPwdCtrl"}).when("/pubmgr/list",{templateUrl:fdRouterViewsBasepath+"pub/views/pubmgrlist.html",controller:"PubMgrListCtrl"}).when("/pubmgr/inpub",{templateUrl:fdRouterViewsBasepath+"pub/views/pubmgrinpub.html",controller:"PubMgrInPubCtrl"}).when("/pubmgr/editpub",{templateUrl:fdRouterViewsBasepath+"pub/views/pubmgreditpub.html",controller:"PubMgrEditPubCtrl"}).otherwise({redirectTo:"/"})}]),app.filter("trustHtml",function(e){return function(t){return e.trustAsHtml(t)}}),angular.module("core",[]).directive("formresult",[function(){return{restrict:"A",templateUrl:"static/app/components/directives/core/formresult.html"}}]),angular.module("core",[]).directive("permission",["BaseInfoService",function(e){return{restrict:"A",link:function(t,r,n){var o=r.style.display;r.style.display="none",e.getUserInfo(function(e){var t=!1,s=!1,a=e.userType;if("1"!=a){var i=n.roles.split(",");if(i.length>0)for(var l in i){var c=i[l];if(c==a){t=!0;break}}{n.funid}s=!0,t&&s&&(r.style.display=o)}else r.style.display=o})}}}]),angular.module("datepicker",[]).directive("datepicker",[function(){return{restrict:"A",require:"ngModel",link:function(e,t,r,n){$(function(){t.datepicker({dateFormat:"yy-mm-dd",onSelect:function(t){e.$apply(function(){n.$setViewValue(t)})}})})}}}]),app.factory("BaseInfoService",["$http",function(e){var t=null;return{getUserInfo:function(r){t?data&&r(data):e.post("getLoginUser").success(function(e){e&&r(e)})}}}]),app.controller("ContractMgrInContractCtrl",function(e,t,r,n,o,s){s.menu="contract"}),app.controller("ContractMgrListCtrl",function(e,t,r,n,o,s){s.menu="contract"}),app.controller("ContractMgrViewContractCtrl",function(e,t,r,n,o,s){s.menu="contract"}),app.factory("ContractService",["$http",function(e){return{test:function(t,r){e.post("formdesign/formdatadel",t).success(function(e){r&&r(e)})}}}]),app.controller("CustomMgrInCustomCtrl",function(e,t,r,n,o,s){s.menu="custom"}),app.controller("CustomMgrListCtrl",function(e,t,r,n,o,s){s.menu="custom"}),app.controller("CustomMgrViewCustomCtrl",function(e,t,r,n,o,s){s.menu="custom"}),app.factory("CustomService",["$http",function(e){return{test:function(t,r){e.post("formdesign/formdatadel",t).success(function(e){r&&r(e)})}}}]),app.controller("FormDataListCtrl",function(e,t,r,n,o,s,a){var i=1,l=10;e.initParams=function(){e.queryParams={page:i,rows:l,formid:r.formid,isreload:!0}},e.initParams(),e.reload=function(){e.initParams(),e.tableParams.reload()},e.tableParams=new n({page:i,count:l},{total:0,getData:function(t,r){e.queryParams.isreload?e.queryParams.isreload=!1:(e.queryParams.page=r.page(),e.queryParams.rows=r.count(),e.queryParams.total=r.total()),o.queryList(e.queryParams,function(n){var o=n.pagingResult.total;e.queryParams.total=o,r.total(o),t.resolve(n.pagingResult.rows)})}}),e.del=function(t){confirm("确认删除?")!==!1&&(t.isdeling=!0,a.del({id:t.id},function(){e.reload()}))},s.queryFormById({id:r.formid},function(t){e.formtitle=t.formResult.data.title,e.formdtcreate=t.formResult.data.dtCreate,e.formdtupdate=t.formResult.data.dtUpdate,e.formdtpub=t.formResult.data.dtPub,e.formFields=t.formFields})}),app.controller("FormDesignCtrl",function(e,t,r){function n(e,t){var r=/(\|-<span(((?!<span).)*plugins=\"(radios|checkboxs|select)\".*?)>(.*?)<\/span>-\||<(img|input|textarea|select).*?(<\/select>|<\/textarea>|\/>))/gi,n=/(\w+)=\"(.?|.+?)\"/gi,o=/<input.*?\/>/gi;t||(t=0);var s=e,a=new Array,i=new Object,l=0,c=0;e.replace(r,function(r,u,m,p,d,f,g){var v=new Array,h=new Object,w="",b="",C=!1,y=r,U=g?g:d;if("radios"==U||"checkboxs"==U?r=m:"select"==U&&(r=r.replace("|-",""),r=r.replace("-|","")),r.replace(n,function(e,r,n){"name"==r&&("NEWFIELD"==n&&(C=!0,t++,n="data_"+t),w=n),"select"==U&&"value"==r?(h[r]||(h[r]=""),h[r]+=b+n,b=","):h[r]=n;var o=new Object;o[r]=n,v.push(o)}),"checkboxs"==U){r=y,r=r.replace("|-",""),r=r.replace("-|","");var w="checkboxs_"+l;h.parse_name=w,h.name="",h.value="",h.content='<span plugins="checkboxs" valids="'+h.valids+'">';var R="",M="";f.replace(o,function(e){var r=!1,o=new Object;e.replace(n,function(e,n,s){"name"==n?("NEWFIELD"==s&&(r=!0,t++,s="data_"+t),h.name+=R+s,R=","):"value"==n&&(h.value+=M+s,M=","),o[n]=s}),h.options||(h.options=new Array),h.options.push(o),o.checked||(o.checked="");var s=o.checked?'checked="checked"':"";if(h.content+='<input type="checkbox" name="'+o.name+'" value="'+o.value+'" fieldname="'+h.fieldname+o.fieldname+'"'+s+"/>"+o.value+"&nbsp;",r){var a=new Object;a.name=o.name,a.plugins=h.plugins,a.fieldname=h.fieldname+o.fieldname,a.fielddesc=h.orgdesc,a.valids=h.valids,i[o.name]=a}}),h.content+="</span>",e=e.replace(r,h.content),s=s.replace(r,"{"+w+"}"),s=s.replace("{|-",""),s=s.replace("-|}",""),a[c]=h,l++}else if(w){if("radios"==U){r=y,r=r.replace("|-",""),r=r.replace("-|",""),h.value="",h.content='<span plugins="radios" name="'+h.name+'" valids="'+h.valids+'">';var P="";f.replace(o,function(e){var t=new Object;e.replace(n,function(e,r,n){"value"==r&&(h.value+=P+n,P=","),t[r]=n}),t.name=h.name,h.options||(h.options=new Array),h.options.push(t),t.checked||(t.checked="");var r=t.checked?'checked="checked"':"";h.content+='<input type="radio" name="'+h.name+'" value="'+t.value+'"  '+r+"/>"+t.value+"&nbsp;"}),h.content+="</span>"}else h.content=C?r.replace(/NEWFIELD/,w):r;if(e=e.replace(r,h.content),s=s.replace(r,"{"+w+"}"),s=s.replace("{|-",""),s=s.replace("-|}",""),C){var I=new Object;I.name=w,I.plugins=h.plugins,I.orgtype=h.orgtype,I.fieldname=h.fieldname,I.fielddesc=h.orgdesc,I.valids=h.valids,i[I.name]=I}a[c]=h}c++});var u=e.replace(/{\|-/g,"");u=u.replace(/-\|}/g,"");var m=new Object({fields:t,template:e,parse:u,data:a,add_fields:i});return JSON.stringify(m)}t.id&&(e.id=t.id),UE.delEditor("formdesigncontainer");var o=null;o=UE.getEditor("formdesigncontainer",{toolleipi:!0,initialFrameWidth:1024,initialFrameHeight:200,enableAutoSave:!1,enableContextMenu:!0,toolbars:[["fullscreen","undo","redo","|","bold","italic","underline","fontborder","strikethrough","removeformat","|","forecolor","backcolor","insertorderedlist","insertunorderedlist","|","fontfamily","fontsize","|","indent","|","justifyleft","justifycenter","justifyright","justifyjustify","|","link","unlink","|","horizontal","spechars","wordimage","|","inserttable","deletetable","mergecells","splittocells","|"]],wordCount:!1,elementPathEnabled:!1}),o.addListener("ready",function(){t.id&&r.post("formdesign/getformbyid",{id:t.id}).success(function(t){e.title=t.formResult.data.title,o.execCommand("focus"),o.setContent(t.formResult.data.contentSrc)})}),e.exec=function(e){o.execCommand(e)},e.save=function(){if(0!=confirm("确认保存?注意：保存之后原始表单以及对应表单已上报数据会清空。")){if(o.queryCommandState("source")&&o.execCommand("source"),void 0===e.title)return void alert("标题不能为空");if(e.title.length>50)return void alert("标题长度不能大于50个字符");if(o.hasContents()){o.sync();var t=o.getContent(),s=JSON.parse(n(t,0));e.issaving=!0,r.post("formdesign/add",{title:e.title,content:s.parse,contentSrc:t,fields:JSON.stringify(s.add_fields),id:e.id}).success(function(t){"0"==t.formResult.success?alert(t.formResult.message):(e.id=t.formResult.data,alert("保存成功")),e.issaving=!1}).error(function(){alert("保存失败"),e.issaving=!1})}else alert("内容不能为空")}},e.preview=function(){if(o.queryCommandState("source")&&o.execCommand("source"),!o.hasContents())return alert("内容不能为空！"),!1;o.sync();var t=o.getContent(),r=n(t,0);e.designZone=JSON.parse(r).parse,e.isDesignZoneActive=!0}}),app.controller("FormDesignListCtrl",function(e,t,r,n,o){e.reset=function(){e.searchTitle=null,e.dtCreateBegin=null,e.dtCreateEnd=null,e.dtPubBegin=null,e.dtPubEnd=null,e.ispub=null,e.pubtype=null};var s=1,a=10;e.queryParams={page:s,rows:a,isreload:!0},e.reload=function(){e.queryParams={page:e.queryParams.page,rows:e.queryParams.rows,dtcreate_begin:e.dtCreateBegin,dtcreate_end:e.dtCreateEnd,dtpub_begin:e.dtPubBegin,dtpub_end:e.dtPubEnd,ispub:e.ispub,title:e.searchTitle,pubtype:e.pubtype,isreload:!0},e.tableParams.reload()},e.tableParams=new r({page:s,count:a},{total:0,getData:function(t,r){e.queryParams.isreload?e.queryParams.isreload=!1:(e.queryParams.page=r.page(),e.queryParams.rows=r.count(),e.queryParams.total=r.total()),n.queryList(e.queryParams,function(n){var o=n.pagingResult.total;e.queryParams.total=o,r.total(o),t.resolve(n.pagingResult.rows)})}}),e.pub=function(t,r){o.pub({id:t,type:r},function(){e.reload()})},e.canclepub=function(t){o.canclepub({id:t},function(){e.reload()})},e.del=function(t){confirm("确认删除?")!==!1&&(t.isdeling=!0,o.del({id:t.id},function(){e.reload()}))}}),app.factory("FormDataListService",["$http",function(e){return{queryList:function(t,r){e.post("formdesign/getformdatas",t).success(function(e){var t=[],n=e.pagingResult.rows;if(n&&n.length>0)for(var o in n){var s=n[o];t.push({id:s.id,dt_create:s.dt_create,form_data:JSON.parse(s.form_data)})}e.pagingResult.rows=t,r&&r(e)})}}}]),app.factory("FormDataService",["$http",function(e){return{del:function(t,r){e.post("formdesign/formdatadel",t).success(function(e){r&&r(e)})}}}]),app.factory("FormDesignListService",["$http",function(e){return{queryList:function(t,r){e.post("formdesign/getforms",t).success(function(e){r&&r(e)})}}}]),app.factory("FormDesignService",["$http",function(e){return{queryFormById:function(t,r){e.post("formdesign/getformbyid",t).success(function(e){var t=JSON.parse(e.formResult.data.fields),n=[],o=5,s=0;$.each(t,function(e,t){return s>=o?!1:(s++,void(t&&t.fielddesc&&n.push({name:e,desc:t.fielddesc})))}),e.formFields=n,r&&r(e)})},del:function(t,r){e.post("formdesign/del",t).success(function(e){r&&r(e)})},pub:function(t,r){e.post("formdesign/pub",t).success(function(e){r&&r(e)})},canclepub:function(t,r){e.post("formdesign/canclepub",t).success(function(e){r&&r(e)})}}}]),app.controller("InvoiceMgrInInvoiceCtrl",function(e,t,r,n,o,s){s.menu="invoice"}),app.controller("InvoiceMgrListCtrl",function(e,t,r,n,o,s){s.menu="invoice"}),app.controller("InvoiceMgrViewInvoiceCtrl",function(e,t,r,n,o,s){s.menu="invoice"}),app.factory("InvoiceService",["$http",function(e){return{test:function(t,r){e.post("formdesign/formdatadel",t).success(function(e){r&&r(e)})}}}]),app.controller("JobMgrInJobCtrl",function(e,t,r,n,o,s){s.menu="job"}),app.controller("JobMgrListCtrl",function(e,t,r,n,o,s){s.menu="job"}),app.controller("JobMgrViewJobCtrl",function(e,t,r,n,o,s){s.menu="job"}),app.factory("JobService",["$http",function(e){return{test:function(t,r){e.post("formdesign/formdatadel",t).success(function(e){r&&r(e)})}}}]),app.factory("PerformanceService",["$http",function(e){return{test:function(t,r){e.post("formdesign/formdatadel",t).success(function(e){r&&r(e)})}}}]),app.controller("PerformanceMgrListCtrl",function(e,t,r,n,o,s){s.menu="performance"}),app.controller("PubMgrInPubCtrl",function(e,t,r,n,o,s){s.menu="pub"}),app.controller("PubMgrListCtrl",function(e,t,r,n,o,s){s.menu="pub"}),app.factory("PubService",["$http",function(e){return{test:function(t,r){e.post("formdesign/formdatadel",t).success(function(e){r&&r(e)})}}}]),app.controller("ResumeMgrInResumeCtrl",function(e,t,r,n,o,s){s.menu="resume"}),app.controller("ResumeMgrListCtrl",function(e,t,r,n,o,s){s.menu="resume"}),app.controller("ResumeMgrViewResumeCtrl",function(e,t,r,n,o,s){s.menu="resume"}),app.factory("ResumeService",["$http",function(e){return{test:function(t,r){e.post("formdesign/formdatadel",t).success(function(e){r&&r(e)})}}}]),app.controller("TeamMgrListCtrl",function(e,t,r,n,o,s){s.menu="team"}),app.controller("TeamMgrMyInfoCtrl",function(e,t,r,n,o,s){s.menu="team"}),app.factory("TeamService",["$http",function(e){return{test:function(t,r){e.post("formdesign/formdatadel",t).success(function(e){r&&r(e)})}}}]),app.factory("UserService",["$http",function(e){return{test:function(t,r){e.post("formdesign/formdatadel",t).success(function(e){r&&r(e)})}}}]),app.controller("UserMgrEditUserCtrl",function(e,t,r,n){t.id?(e.id=t.id,r.post("usermgr/getUserById",{id:e.id}).success(function(t){t.createTime=null,t.updateTime=null,e.user=t})):n.getUserInfo(function(t){e.user={userType:"1"==t.userType?"2":"3"}}),e.saveUser=function(){e.formresult=null;var t=$("#usermgr-list-form").isHappy({fields:{loginName:{required:!0,maxlength:20},userName:{required:!0,maxlength:20},birthday:{dateISO:!0},orgCode:{maxlength:40},department:{maxlength:100},comment:{maxlength:100}}});t&&(e.isrequest=!0,r.post("usermgr/editUser",e.user).success(function(t){e.formresult=t,t.data&&(e.user.id=t.data.id),e.isrequest=!1}))}}),app.controller("UserMgrListCtrl",function(e,t,r,n){var o=1,s=10;e.queryParams={page:o,rows:s,isreload:!0},e.reload=function(){e.queryParams={page:e.queryParams.page,rows:e.queryParams.rows,username:e.searchUserName,loginname:e.searchLoginName,usertype:e.searchUserType,isDisabled:e.searchIsDisabled,isreload:!0},e.tableParams.reload()},e.tableParams=new n({page:o,count:s},{total:0,getData:function(t,n){e.queryParams.isreload?e.queryParams.isreload=!1:(e.queryParams.page=n.page(),e.queryParams.rows=n.count(),e.queryParams.total=n.total()),r.post("usermgr/getUserList",e.queryParams).success(function(r){var o=r.total;e.queryParams.total=o,n.total(o),t.resolve(r.rows)})}}),e.delUser=function(t){confirm("确认删除?")!==!1&&r.post("usermgr/delUser",{id:t.id}).success(function(){e.reload()})},e.disabledUser=function(t){confirm("确认锁定?")!==!1&&r.post("usermgr/disabledUser",{id:t.id}).success(function(){e.reload()})},e.enableUser=function(t){r.post("usermgr/enableUser",{id:t.id}).success(function(){e.reload()})}}),app.controller("UserMgrInUserCtrl",function(e,t,r,n,o,s){s.menu="user"}),app.controller("UserMgrListCtrl",function(e,t,r,n,o,s){s.menu="user"}),app.controller("UserMgrViewUserCtrl",function(e,t,r,n,o,s){s.menu="user"}),app.controller("UserResetPwdCtrl",function(e,t,r,n,o,s){s.menu="resetpwd"});